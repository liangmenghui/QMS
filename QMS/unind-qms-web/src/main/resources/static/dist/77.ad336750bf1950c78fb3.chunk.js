webpackJsonp([77],{1204:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(1922),r=a.n(s);for(var o in s)"default"!==o&&function(e){a.d(t,e,function(){return s[e]})}(o);var i=a(2108),l=a.n(i),m=a(1),n=m(r.a,l.a,!1,null,null,null);n.options.__file="src/view/member/lab/sample/samplelist.vue",t.default=n.exports},1922:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(72),r=function(e){return e&&e.__esModule?e:{default:e}}(s),o=a(98);t.default={created:function(){this.dialog.formItem.bsSampleStatrtTime=new Date,this.getReload()},computed:(0,r.default)({},(0,o.mapState)({menuData:function(e){return e.menuData}})),data:function(){var e=this;return{sampleUploadState:!1,msg:"开始测试",start:0,end:15,tabs:1,dialog:{ruleForm:{bsCostTime:[{required:!0,message:"用时不能为空",trigger:"blur"}],bsCode:[{required:!0,message:"请填写编码",trigger:"blur"}],bsName:[{required:!0,message:"请填写名称",trigger:"blur"}],bsQty:[{required:!0,message:"请填写数量",trigger:"blur"}],bsSampleTime:[{required:!0,message:"请填写登记时间",trigger:"blur"}],bsReportTime:[{required:!0,message:"请填写要报告时间",trigger:"blur"}]},modal_dialog:!1,modal_dialog2:!1,modal_dialog4:!1,formItem:{bjsj:"",id:"",bsCode:"",bsName:"",bsSampleTime:"",bsReportTime:"",bsQty:"",bsStatus:"",bsComment:"",bsPath:"",arry:"",item:[]}},formQuery:{eqName:"",testx:"",bsSampleStatrtTime:"",bsCostTime:"",bsPath:"",bsCode:"",bsName:"",bsReportTime:"",bsSampleTime:"",bsComment:"",bsQty:""},formQ:{bsPartNo:"",bsSampleName:"",flag:""},Query:{bsName:"",bsCode:"",state:""},queryData:{id:"",bsStatus:"",bsName:"",bsCode:""},dict:{bsStatus:[{value:0,name:"待测试"},{value:1,name:"测试中"},{value:2,name:"已完成"},{value:3,name:"已中止"}]},datagrid:{queryParams:{page:1,rows:15,pkParent:-1},pagination:[15,50,100],data:{rows:[],total:0,rows1:[]},columns:[{title:"产品编码",key:"bsCode"},{title:"样品名称",key:"bsName"},{title:"登记时间",key:"bsSampleTime"},{title:"要求报告时间",key:"bsReportTime"},{title:"样品数量",key:"bsQty"},{title:"状态",key:"bsStatus",render:function(t,a){return t("span",e.dict.bsStatus[a.row.bsStatus].name)}},{title:"检测项目",key:"bsComment"},{title:"操作",key:"action",render:function(t,a){var s=[];return 2!=a.row.bsStatus&&3!=a.row.bsStatus&&e.menuData.perms.EDIT&&s.push(t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"10px",marginBottom:"10px"},on:{click:function(){var t=a;e.$router.push({name:"addSample",query:t})}}},0==a.row.bsStatus?"开始测试":"填写数据")),0!=a.row.bsStatus&&e.menuData.perms.QUERY&&s.push(t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"10px",marginBottom:"10px"},on:{click:function(){var t=a;e.$router.push({name:"detail",query:t})}}},"详情")),1==a.row.bsStatus&&e.menuData.perms.EDIT&&s.push(t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"10px",marginBottom:"10px"},on:{click:function(){e.testcomp(a)}}},"测试完成")),0==a.row.bsStatus&&e.menuData.perms.DELETE&&s.push(t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"10px",marginBottom:"10px"},on:{click:function(){e.deleteSample(a)}}},"删除")),0!=a.row.bsStatus&&e.menuData.perms.ADD&&s.push(t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"10px",marginBottom:"10px"},on:{click:function(){e.deleteSample(a)}}},"删除")),t("div",s)}}]}}},methods:{uploadBefore:function(){},uploadSuccess:function(e,t,a){e.result&&(this.formQuery.bsPath=e.data,this.sampleUploadState=!0,this.$Message.success("上传成功"))},uploadError:function(e,t,a){this.$Message.error("上传失败，请重新上传")},sendMail:function(){var e=this;this.formQ.bsSampleName=this.formQuery.bsName,this.formQ.bsPartNo=this.formQuery.bsCode,this.formQ.flag="sendSample",this.api.sample.sendMail(this.formQ).then(function(t){t.result?e.$Message.success("发送邮件成功"):e.$Message.error("自动发送邮件失败，请手动发送")})},addSample:function(){var e=this;this.sampleUploadState?this.api.sample.checkinSave(this.formQuery).then(function(t){e.getReload(),e.sendMail(),e.$Message.success("添加成功")}):this.$Message.error("图纸文件不能为空")},getReload:function(){var e=this;this.api.sample.selectSample().then(function(t){t.result?(e.datagrid.data.rows1=e.datagrid.data.rows,e.datagrid.data.rows=t.data.rows.slice(e.start,e.end),e.datagrid.data.total=t.data.total):e.$Message.error(t.msg)})},showAddDialog:function(){this.sampleUploadState=!1,this.dialog.modal_dialog4=!0},showM:function(e){var t=this;this.dialog.formItem.bsCode=e.row.bsCode,this.dialog.formItem.id=e.row.id,this.dialog.formItem.bsName=e.row.bsName,this.dialog.formItem.bsSampleTime=e.row.bsSampleTime,this.dialog.formItem.bsReportTime=e.row.bsReportTime,this.dialog.formItem.bsQty=e.row.bsQty,this.dialog.formItem.bsStatus=this.dict.bsStatus[e.row.bsStatus].name,this.dialog.formItem.bsComment=e.row.bsComment,this.dialog.modal_dialog=!0,this.dialog.formItem.arry="",this.api.equipment.selectTest().then(function(e){if(null==t.dialog.formItem.item||""==t.dialog.formItem.item)for(var a=0;a<e.data.total;a++)t.dialog.formItem.item.push(e.data.rows[a])})},testcomp:function(e){var t=this;this.queryData.id=e.row.id,this.queryData.bsName=e.row.bsName,this.queryData.bsCode=e.row.bsCode,this.queryData.bsStatus=2,this.api.sample.updateStatuss(this.queryData).then(function(a){a.result?(t.getReload(),t.sendss(e)):t.$Message.error("完成实验失败，请重试")})},sendss:function(e){var t=this;this.formQ.bsSampleName=e.row.bsName,this.formQ.bsPartNo=e.row.bsCode,this.formQ.flag="testPerson",this.api.sample.sendMail(this.formQ).then(function(e){e.result?t.$Message.success("发送邮件成功"):t.$Message.error("自动发送邮件失败，请手动发送")})},cancel:function(){},deleteSample:function(e){var t=this;console.log(e),this.$Modal.confirm({title:"提示信息",content:"<p>是否确定删除？</p>",loading:!0,onOk:function(){t.api.sample.delete(e.row).then(function(e){e.result?(t.getReload(),t.$Message.info("删除成功"),t.$Modal.remove()):t.$Message.error("删除失败")})}})},changePage:function(e){this.start=(e-1)*this.datagrid.queryParams.rows,this.end=e*this.datagrid.queryParams.rows,this.getReload()},chageSize:function(e){this.datagrid.queryParams.rows=e,this.start=0,this.end=e,this.getReload()}}}},2108:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Row",[a("i-col",[a("Form",{ref:"formQuery",staticClass:"query_area",attrs:{model:e.formQuery,inline:""}},[e.menuData.perms.ADD?a("Form-item",[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.showAddDialog()}}},[e._v("新增样品")])],1):e._e()],1)],1)],1),e._v(" "),a("Row",[a("Modal",{attrs:{title:""},on:{"on-ok":e.addSample,"on-cancel":e.cancel},model:{value:e.dialog.modal_dialog4,callback:function(t){e.$set(e.dialog,"modal_dialog4",t)},expression:"dialog.modal_dialog4"}},[a("Form",{ref:e.dialog.ruleForm,attrs:{model:e.formQuery,rules:e.dialog.ruleForm,"label-width":80}},[a("Form-item",{staticStyle:{width:"40%"},attrs:{prop:"bsQty",label:" 样品数量："}},[a("InputNumber",{staticStyle:{width:"300px"},attrs:{min:1,type:"text",placeholder:"样品数量"},model:{value:e.formQuery.bsQty,callback:function(t){e.$set(e.formQuery,"bsQty",t)},expression:"formQuery.bsQty"}})],1),e._v(" "),a("Form-item",{attrs:{prop:"bsCode",label:"样品编码："}},[a("Input",{staticStyle:{width:"300px"},attrs:{type:"text",placeholder:"样品编码"},model:{value:e.formQuery.bsCode,callback:function(t){e.$set(e.formQuery,"bsCode",t)},expression:"formQuery.bsCode"}})],1),e._v(" "),a("Form-item",{attrs:{prop:"bsName",label:"样品名称："}},[a("Input",{staticStyle:{width:"300px"},attrs:{type:"text",placeholder:"样品名称"},model:{value:e.formQuery.bsName,callback:function(t){e.$set(e.formQuery,"bsName",t)},expression:"formQuery.bsName"}})],1),e._v(" "),a("Form-item",{attrs:{prop:"bsReportTime",label:"获取报告时间："}},[a("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"Select date"},model:{value:e.formQuery.bsReportTime,callback:function(t){e.$set(e.formQuery,"bsReportTime",t)},expression:"formQuery.bsReportTime"}})],1),e._v(" "),a("Form-item",{attrs:{prop:"bsComment",label:"检测项目:"}},[a("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:7},placeholder:"填写送测内容"},model:{value:e.formQuery.bsComment,callback:function(t){e.$set(e.formQuery,"bsComment",t)},expression:"formQuery.bsComment"}})],1),e._v(" "),a("Form-item",{attrs:{prop:"bsComment",label:"检测项目:"}},[a("Upload",{attrs:{type:"drag",action:"admin/lab/sample/updateFile",data:{bsCode:this.formQuery.bsCode},"before-upload":e.uploadBefore,"on-success":e.uploadSuccess,"on-error":e.uploadError}},[a("div",{staticStyle:{padding:"20px 0"}},[a("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"40"}}),e._v(" "),a("p",[e._v("请选择文件")])],1)])],1)],1)],1)],1),e._v(" "),a("Row",[a("i-col",{attrs:{span:"24"}},[a("Table",{staticStyle:{height:"auto"},attrs:{data:e.datagrid.data.rows,columns:e.datagrid.columns,stripe:""}}),e._v(" "),a("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:e.datagrid.data.total,current:1,"page-size":e.datagrid.queryParams.rows,"page-size-opts":e.datagrid.pagination,"show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.chageSize}})],1)])],1)],1)],1)},r=[];s._withStripped=!0;var o={render:s,staticRenderFns:r};t.default=o}});