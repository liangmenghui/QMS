webpackJsonp([55],{1052:function(t,e,s){"use strict";function a(t){r||s(1871)}Object.defineProperty(e,"__esModule",{value:!0});var i=s(1631),n=s.n(i);for(var d in i)"default"!==d&&function(t){s.d(e,t,function(){return i[t]})}(d);var o=s(1873),l=s.n(o),r=!1,c=s(1),p=a,f=c(n.a,l.a,!1,p,null,null);f.options.__file="src\\view\\feedback\\FeedbackHandle.vue",e.default=f.exports},1631:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=s(15),n=a(i),d=s(24),o=a(d);e.default={data:function(){return{expandedCollapses:["1","0","0","0","0","0","0","0"],modal_dialog:!1,modal_form:{},form:{},analysis:{handlerBy:{}},handlers:[],users:[],userSelections:[],selectedUser:{},perms:{verify:!1,edit:!1,alloc:!1},stepTitles:["",this.$t("feedback.HandlingPerson"),this.$t("feedback.ProblemDescription"),this.$t("feedback.TemporaryMeasures"),this.$t("feedback.TheRootCause"),this.$t("feedback.SelectPermanentCorrectiveAction"),this.$t("feedback.APermanentCorrectiveActionTaken"),this.$t("feedback.PreventiveAction")]}},created:function(){this.form.id=this.$route.query.feedbackId,this.getData(),this.gethandlers()},methods:{getData:function(){var t=this;this.api.feedback.getlist({id:this.form.id}).then(function(e){e.data.rows.length&&(t.form=e.data.rows[0]),t.expandedCollapses[t.form.bsStep]="1",t.perms.edit=t.form.bsStatus<3,t.perms.verify=t.form.bsStatus<3,t.perms.alloc=t.form.bsStatus<3}),this.api.user.getlist().then(function(e){t.users=e.data.rows})},gethandlers:function(){var t=this;this.api.feedback.gethandlers({bsFeedbackId:this.form.id}).then(function(e){t.handlers=[[],[],[],[],[],[],[],[]];for(var s=!1,a=e.data.rows.length-1;a>=0;a--){var i=e.data.rows[a];void 0==i.bsStatus&&(i.bsStatus=0),i.canVerify=i.handlerBy.bsName==o.default.get("userInfo")&&0==i.bsStatus&&t.form.bsStatus<3,1!=i.bsType||s||i.handlerBy.bsName!=o.default.get("user")||(s=!0),t.handlers[i.bsType].push(i)}t.handlers[2].length>0&&(t.analysis=t.handlers[2][0],t.analysis.canVerify=s),t.userSelections=t.handlers[1].map(function(t){return t.handlerBy})})},editHandler:function(){var t=this;if(void 0==this.selectedUser.id)return this.$Message.error("负责人不能为空");if(this.modal_form.bsHandlerId=this.selectedUser.id,1==this.modal_form.bsType)for(var e=this.handlers[1].length-1;e>=0;e--){var s=this.handlers[1][e];if(s.handlerBy.id==this.modal_form.bsHandlerId)return this.$Message.error("不能重复添加处理人员")}void 0==this.modal_form.id?this.api.feedback.addhandler(this.modal_form).then(function(e){t.$Message.info("添加成功"),t.gethandlers()}):this.api.feedback.edithandler(this.modal_form).then(function(e){t.$Message.info("修改成功"),t.gethandlers()})},removeHandler:function(t){var e=this;this.api.feedback.deletehandler({id:t.id}).then(function(t){e.$Message.info("删除成功"),e.gethandlers()})},addAction:function(t){this.selectedUser={},this.modal_form={},this.modal_form.bsFeedbackId=this.form.id,this.modal_form.bsType=t,this.modal_form.title=this.stepTitles[t],this.modal_dialog=!0},excuteActions:function(t){var e=this.handlers[t];if(0==e.length)return this.$Message.error("无可执行措施");for(var s=e.length-1;s>=0;s--){var a=e[s];if(1!=a.bsStatus)return this.sendTodo(a.handlerBy.id,"["+this.stepTitles[t]+"]")}this.form.bsStep=t+1,this.$Message.info("当前步骤完成,请分配和执行下一步骤"),this.submitFeeback()},editAction:function(t){this.selectedUser=t.handlerBy,this.modal_form={id:t.id,bsFeedbackId:this.form.id,bsType:t.bsType,title:this.stepTitles[t.bsType],bsStatus:t.bsStatus,bsDesc:t.bsDesc},this.modal_dialog=!0},finishAction:function(t){t.bsStatus=1,this.selectedUser=t.handlerBy,this.modal_form={id:t.id,bsFeedbackId:this.form.id,bsType:t.bsType,title:this.stepTitles[t.bsType],bsStatus:1,bsDesc:t.bsDesc},this.editHandler(),this.finishTodo(t.handlerBy.id),this.excuteActions(t.bsType)},submitAnalysis:function(){this.selectedUser=JSON.parse(o.default.get("userInfo")),this.modal_form={bsFeedbackId:this.form.id,bsType:2,bsStatus:1,bsDesc:this.analysis.bsDesc},this.modal_form.id=this.analysis.id,this.editHandler(),this.form.bsStep<3&&(this.form.bsStep=3),this.submitFeeback()},submitFeeback:function(){var t=this;1==this.form.bsStatus&&(this.form.bsStatus=2);var e=(0,n.default)({},this.form);e=this.$Util.formattedParams(e),delete e.feedbackerBy,this.api.feedback.edit(e).then(function(e){t.$Message.info("修改成功")})},sendTodo:function(t,e){var s={bsUserId:t,bsRouter:"/qms/feedback/handle",bsTitle:"客诉:"+e+"--"+this.form.bsPrName,bsType:31,bsReferId:this.form.id};this.api.todo.add(s).then(function(t){})},finishTodo:function(t){var e={bsUserId:t,bsType:31,bsReferId:this.form.id};this.api.todo.close(e).then(function(t){})},closeFeedback:function(){this.form.bsStatus=3,this.submitFeeback()},formatter:function(t,e){return this.$t("feedback.projectStatus["+t.bsStatus+"]")}}}},1871:function(t,e,s){var a=s(1872);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);s(28)("e404233a",a,!1,{})},1872:function(t,e,s){e=t.exports=s(27)(!1),e.push([t.i,'\nbody{font-size: 14px;font-family: "Microsoft YaHei"\n}\n.feedbackhandle .title1{\r\n\tfloat: left;\n}\n.feedbackhandle .title2{\r\n\tfloat: left;    display: inline-block;\r\n    line-height: 20px;\r\n    font-size: 14px;\r\n    color: #1c2438;\r\n    font-weight: 700;\r\n\tmargin-left: 1%;margin-right: 1%;margin-top: 8px;\n}\n.feedbackhandle #product-body{\r\n\theight:170px;padding-top: 10px;padding-left: 5%;\n}\n.feedbackhandle .product-body-div{\r\n\theight: 40px;font-size: 14px;\n}\n.feedbackhandle .product-body-div span{\r\n\tcolor:#8499a3;\n}\n.feedbackhandle #handler-body{\r\n\tpadding-left: 5%;padding-right:5%;padding-bottom: 10px;\n}\n.feedbackhandle #problem-body{\r\n\tpadding-top: 10px;padding-left: 5%;padding-bottom: 10px;\n}\n.feedbackhandle .principal-div{\r\n\t\theight: 50px;margin-top: 30px;\n}\n.feedbackhandle .principal-div1{\r\n\t\tfloat: left;margin-top: 10px;width:60px;font-size: 14px;\n}\n.feedbackhandle .principal-div2{\r\n\t\tfloat: left;\n}\n.feedbackhandle .time-div{\r\n\t\theight: 50px;margin-top: 20px;\n}\n.feedbackhandle .time-div1{\r\n\t\tfloat: left;margin-top: 10px;width:60px;font-size: 14px;\n}\n.feedbackhandle .submit-div{\r\n\t\theight: 40px;margin-top:20px;padding-top: 10px;\n}\n.feedbackhandle #measures-body{\r\n\tpadding-left: 5%;padding-right:5%;padding-bottom: 10px;\n}\n.feedbackhandle #why-body{\r\n\t\tpadding-left: 5%;padding-right:5%;padding-bottom: 10px;\n}\n.feedbackhandle #select-body{\r\n\t\tpadding-left: 5%;padding-right:5%;padding-bottom: 10px;\n}\n.feedbackhandle #perform-body{\r\n\t\tpadding-left: 5%;padding-right:5%;padding-bottom: 10px;\n}\n.feedbackhandle #prevent-body{\r\n\t\tpadding-left: 5%;padding-right:5%;padding-bottom: 10px;\n}\n.feedbackhandle #bottom{\r\n\t\tmargin-top: 30px;margin-bottom: 20px;padding-top: 50px;padding-bottom: 50px;\n}\n.feedbackhandle .submit-div .el-button{\r\n\t\twidth: 10%;padding:7px 20px;\n}\r\n',""])},1873:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"feedbackhandle"},[s("div",{staticStyle:{height:"50px"}},[s("Col",{attrs:{md:9}},[s("div",{staticStyle:{width:"36%",height:"1px"}})]),t._v(" "),s("Col",{attrs:{md:3}},[s("router-link",{attrs:{to:{path:"details"}}},[s("el-button",{staticStyle:{width:"99%",height:"40px","border-radius":"8px 0px 0px 8px","font-size":"14px"},attrs:{type:"primary"}},[t._v("\n\t\t\t\t\t\t"+t._s(t.$t("feedback.DetailsOfFeedback"))+"\n\t\t\t\t\t")])],1)],1),t._v(" "),s("Col",{attrs:{md:3}},[s("div",{staticStyle:{width:"99%",height:"40px","border-radius":"0px 8px 8px 0px","background-color":"#76C6F3",color:"white","padding-top":"10px","font-size":"14px"}},[s("center",[t._v(t._s(t.$t("feedback.CustomerComplaintHandling")))])],1)]),t._v(" "),s("Col",{attrs:{md:9}},[s("div",{staticStyle:{width:"36%",height:"1px"}})])],1),t._v(" "),s("Collapse",{attrs:{accordion:""},model:{value:t.expandedCollapses[0],callback:function(e){t.$set(t.expandedCollapses,0,e)},expression:"expandedCollapses[0]"}},[s("Panel",{attrs:{name:"1"}},[s("div",{staticClass:"title1"},[s("Icon",{staticStyle:{"font-size":"16px",color:"#ff9900"},attrs:{type:"ios-medical"}})],1),t._v(" "),s("div",{staticClass:"title2"},[t._v(t._s(t.$t("feedback.ProductInformation")))]),t._v(" "),s("div",{attrs:{slot:"content",id:"product-body"},slot:"content"},[s("div",{staticClass:"product-body-div"},[t._v(t._s(t.$t("feedback.ProductName"))+"："),s("span",[t._v(t._s(t.form.bsPrName))])]),t._v(" "),s("div",{staticClass:"product-body-div"},[t._v(t._s(t.$t("feedback.ProductNumber"))+"："),s("span",[t._v(t._s(t.form.bsPrCode))])]),t._v(" "),s("div",{staticClass:"product-body-div"},[t._v(t._s(t.$t("feedback.NumberOfQuestions"))+"："),s("span",[t._v(t._s(t.form.id))])]),t._v(" "),s("div",{staticClass:"product-body-div"},[t._v(t._s(t.$t("feedback.handleState"))+"："),s("span",[t._v(t._s(t.$t("feedback.statusDesc["+t.form.bsStatus+"]")))])])])])],1),t._v(" "),s("Collapse",{staticStyle:{"margin-top":"10px"},attrs:{accordion:""},model:{value:t.expandedCollapses[1],callback:function(e){t.$set(t.expandedCollapses,1,e)},expression:"expandedCollapses[1]"}},[s("Panel",{attrs:{name:"1"}},[s("div",{staticClass:"title1"},[s("Icon",{staticStyle:{"font-size":"16px",color:"#ff9900"},attrs:{type:"ios-medical"}})],1),t._v(" "),s("div",{staticClass:"title2"},[t._v(t._s(t.$t("feedback.HandlingPerson")))]),t._v(" "),s("div",{attrs:{slot:"content",id:"handler-body"},slot:"content"},[s("div",[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.handlers[1]}},[s("el-table-column",{attrs:{prop:"handlerBy.bsName",label:"负责人"}}),t._v(" "),s("el-table-column",{attrs:{prop:"handlerBy.bsMobile",label:"电话"}}),t._v(" "),s("el-table-column",{attrs:{prop:"handlerBy.bsEmail",label:"电子邮箱"}}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("Button.operating")},scopedSlots:t._u([{key:"default",fn:function(e){return[t.perms.alloc?s("el-button",{attrs:{size:"mini"},on:{click:function(s){t.removeHandler(e.row)}}},[t._v("删除")]):t._e()]}}])})],1)],1),t._v(" "),s("div",{staticClass:"submit-div"},[t.perms.alloc?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){t.addAction(1)}}},[t._v("\n\t\t\t\t\t"+t._s(t.$t("feedback.AddHandler"))+"\n\t\t\t\t")]):t._e()],1)])])],1),t._v(" "),s("Collapse",{staticStyle:{"margin-top":"10px"},attrs:{accordion:""},model:{value:t.expandedCollapses[2],callback:function(e){t.$set(t.expandedCollapses,2,e)},expression:"expandedCollapses[2]"}},[s("Panel",{attrs:{name:"1"}},[s("div",{staticClass:"title1"},[s("Icon",{staticStyle:{"font-size":"16px",color:"#ff9900"},attrs:{type:"ios-medical"}})],1),t._v(" "),s("div",{staticClass:"title2"},[t._v(t._s(t.$t("feedback.ProblemDescription")))]),t._v(" "),s("div",{attrs:{slot:"content",id:"problem-body"},slot:"content"},[s("div",[s("p",[t._v(t._s(t.$t("feedback.DescribingTheContent")))]),t._v(" "),s("el-input",{staticStyle:{width:"50%"},attrs:{type:"textarea",autosize:{minRows:4},readonly:!(t.analysis.canVerify||t.perms.edit)},model:{value:t.analysis.bsDesc,callback:function(e){t.$set(t.analysis,"bsDesc",e)},expression:"analysis.bsDesc"}})],1),t._v(" "),s("div",{staticClass:"principal-div"},[s("div",{staticClass:"principal-div1"},[t._v(t._s(t.$t("feedback.lastEditor"))+": "+t._s(t.analysis.handlerBy.bsName))])]),t._v(" "),s("div",{staticClass:"submit-div"},[t.analysis.canVerify||t.perms.edit?s("el-button",{attrs:{type:"primary"},on:{click:t.submitAnalysis}},[t._v(t._s(t.$t("feedback.submit")))]):t._e()],1)])])],1),t._v(" "),t._l(t.handlers,function(e,a){return s("div",[a>2?s("Collapse",{staticStyle:{"margin-top":"10px"},attrs:{accordion:""},model:{value:t.expandedCollapses[a],callback:function(e){t.$set(t.expandedCollapses,a,e)},expression:"expandedCollapses[index]"}},[s("Panel",{attrs:{name:"1"}},[s("div",{staticClass:"title1"},[s("Icon",{staticStyle:{"font-size":"16px",color:"#ff9900"},attrs:{type:"ios-medical"}})],1),t._v(" "),s("div",{staticClass:"title2"},[t._v(t._s(t.stepTitles[a]))]),t._v(" "),s("div",{attrs:{slot:"content",id:"measures-body"},slot:"content"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.handlers[a]}},[s("el-table-column",{attrs:{prop:"bsDesc",label:"事项"}}),t._v(" "),s("el-table-column",{attrs:{prop:"bsStatus",label:"状态",formatter:t.formatter}}),t._v(" "),s("el-table-column",{attrs:{prop:"handlerBy.bsName",label:"负责人"}}),t._v(" "),s("el-table-column",{attrs:{prop:"bsModifiedTime",label:"时间"}}),t._v(" "),s("el-table-column",{attrs:{label:t.$t("Button.operating")},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.canVerify?s("el-button",{attrs:{size:"mini"},on:{click:function(s){t.finishAction(e.row)}}},[t._v("完成")]):t._e(),t._v(" "),t.perms.edit?s("el-button",{attrs:{size:"mini"},on:{click:function(s){t.editAction(e.row)}}},[t._v("修改")]):t._e(),t._v(" "),t.perms.alloc?s("el-button",{attrs:{size:"mini"},on:{click:function(s){t.removeHandler(e.row)}}},[t._v("删除")]):t._e()]}}])})],1),t._v(" "),s("div",{staticClass:"submit-div"},[t.form.bsStep==a&&t.perms.alloc?s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.excuteActions(a)}}},[t._v("开始执行")]):t._e(),t._v(" "),t.form.bsStep<=a&&t.perms.alloc?s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.addAction(a)}}},[t._v("添加项目")]):t._e()],1)],1)])],1):t._e()],1)}),t._v(" "),s("div",{attrs:{id:"bottom"}},[s("center",[t.perms.verify?s("el-button",{staticStyle:{padding:"7px 20px"},attrs:{type:"success"},on:{click:t.closeFeedback}},[s("i",{staticClass:"el-icon-circle-close-outline"}),t._v("  "+t._s(t.$t("feedback.CloseTheCustomerComplaint"))+"\n\t\t\t\t")]):t._e()],1)],1),t._v(" "),s("Modal",{attrs:{title:t.modal_form.title},on:{"on-ok":t.editHandler},model:{value:t.modal_dialog,callback:function(e){t.modal_dialog=e},expression:"modal_dialog"}},[s("div",{staticClass:"modeform"},[s("el-form",{attrs:{"label-width":"120px"}},[t.modal_form.bsType>1?s("el-form-item",{attrs:{label:t.$t("feedback.project")}},[s("el-input",{attrs:{placeholder:"请输入"},model:{value:t.modal_form.bsDesc,callback:function(e){t.$set(t.modal_form,"bsDesc",e)},expression:"modal_form.bsDesc"}})],1):t._e(),t._v(" "),s("el-form-item",{attrs:{label:t.$t("approved.principal")}},[s("el-select",{staticStyle:{width:"300px"},attrs:{"value-key":"id",placeholder:"请选择"},model:{value:t.selectedUser,callback:function(e){t.selectedUser=e},expression:"selectedUser"}},[t._l(t.userSelections,function(e){return t.modal_form.bsType>1?s("el-option",{key:e.id,attrs:{label:e.bsName,value:e}}):t._e()}),t._v(" "),t._l(t.users,function(e){return 1==t.modal_form.bsType?s("el-option",{key:e.id,attrs:{label:e.bsName,value:e}}):t._e()})],2)],1)],1)],1)])],2)},i=[];a._withStripped=!0;var n={render:a,staticRenderFns:i};e.default=n}});