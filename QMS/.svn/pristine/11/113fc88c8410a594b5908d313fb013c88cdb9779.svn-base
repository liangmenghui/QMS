webpackJsonp([30],{1171:function(e,t,a){"use strict";function s(e){m||a(2051)}Object.defineProperty(t,"__esModule",{value:!0});var r=a(1885),i=a.n(r);for(var o in r)"default"!==o&&function(e){a.d(t,e,function(){return r[e]})}(o);var l=a(2057),n=a.n(l),m=!1,u=a(1),d=s,b=u(i.a,n.a,!1,d,null,null);b.options.__file="src/view/member/lab/sample/checkin.vue",t.default=b.exports},1885:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(72),i=s(r),o=a(3),l=s(o),n=a(11),m=s(n),u=a(98),d=a(2053),b=s(d);t.default={data:function(){var e,t=this;return{show:!0,dialog:(e={data:{rows:[],total:0},modal_dialog:!1,modal_dialog2:!1,modal_dialog4:!1,testx:[],datagrid:{data:{rows:[],total:0},columns:[{type:"expand",key:"bsCode",align:"center",render:function(e,a){return e(b.default,{props:{data:a},on:{returnadd:function(e){var a=e.index;e.row;(0,m.default)(t.dialog.datagrid.data.rows[a],e.row),t.formQuery.bsCostTime=0;for(var s=0;s<t.dialog.datagrid.data.rows.length;s++)t.formQuery.bsCostTime+=Number(t.dialog.datagrid.data.rows[s].testTime)*Number(t.formQuery.bsQty);t.CompTime()},returncancle:function(e){var a=e.index;t.$refs.dialogTable.toggleExpand(a)},getRowLoad:function(e){var a=e.index;t.removeRow(a)}}})}},{title:"测试项",key:"testx"},{title:"测试设备",key:"bsName"},{title:"测试时间",key:"testTime"},{title:"Nominal Spec基准值",key:"bsBaseline"},{title:"USL+上限值",key:"bsBaselineUp"},{title:"USL+下限值",key:"bsBaselineDown"},{title:"测试数据",key:"bsBaseData"},{title:"Mean",key:"bsMean"},{title:"Range",key:"bsRange"},{title:"Result",key:"bsResult"},{title:"备注",key:"bsSampleComment"},{title:"操作",key:"action",width:150,align:"center",render:function(e,a){return e("div",[e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.removeRow(a)}}},"移除行")])}}]},queryParams:{page:1,rows:25,pkParent:-1},dict:{bsStatus:[{value:0,name:"待测试"},{value:1,name:"测试中"},{value:2,name:"已完成"},{value:3,name:"已中止"}]},pagination:[25,50,100]},(0,l.default)(e,"data",{rows:[],total:0}),(0,l.default)(e,"data1",{rows:[],total:0}),(0,l.default)(e,"columns1",[{title:"测试项",key:"testx"},{title:"测试设备",key:"bsName"},{title:"测试时间",key:"testTime"},{title:"Nominal Spec基准值",key:"bsBaseline"},{title:"USL+上限值",key:"bsBaselineUp"},{title:"USL+下限值",key:"bsBaselineDown"},{title:"测试数据",key:"bsBaseData"},{title:"Mean",key:"bsMean"},{title:"Range",key:"bsRange"},{title:"Result",key:"bsResult"},{title:"备注",key:"bsSampleComment"}]),(0,l.default)(e,"columns",[{title:"产品编码",key:"bsCode"},{title:"样品名称",key:"bsName"},{title:"登记时间",key:"bsSampleTime"},{title:"要求报告时间",key:"bsReportTime"},{title:"样品数量",key:"bsQty"},{title:"状态",key:"bsStatus",render:function(e,a){return e("span",t.dialog.dict.bsStatus[a.row.bsStatus].name)}},{title:"测试内容",key:"bsComment"},{title:"操作",key:"action",render:function(e,a){var s=[];return s.push(e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.download(a)}}},"下载图纸")),e("div",s)}}]),(0,l.default)(e,"modal_dialog",!1),(0,l.default)(e,"modal_dialog1",!1),e),formQuery:{bsSampleComment:"",testx:"",bsSampleStatrtTime:"",bsCostTime:0,bsCode:"",bsName:"",bsReportTime:"",bsSampleTime:"",bsComment:"",bsQty:"",bsCompTime:"",bjsj:"",pkPerson:"",bsStatus:0,ATestx:[],ATime:[],AEqname:[],flag:""},Query:{bsName:"",bsCode:""},bsQuery:{bsPartNo:"",bsName:""},formQu:{id:""}}},computed:(0,i.default)({},(0,u.mapState)({menuData:function(e){return e.menuData}})),created:function(){this.formQuery.bsSampleStatrtTime=new Date,this.getData()},methods:{selectlist:function(){var e=this;this.api.sampletesttime.selectlist(this.bsQuery).then(function(t){if(0!=t.data.total)for(var a=0;a<t.data.total;a++)e.dialog.datagrid.data.total=e.dialog.datagrid.data.total+1,e.dialog.datagrid.data.rows.push({testx:t.data.rows[a].testx,testTime:t.data.rows[a].testTime,bsName:t.data.rows[a].bsName,bsBaseline:t.data.rows[a].bsBaseline,bsBaselineDown:t.data.rows[a].bsBaselineDown,bsBaselineUp:t.data.rows[a].bsBaselineUp,bsBaseData:t.data.rows[a].bsBaseData,bsMean:t.data.rows[a].bsMean,bsRange:t.data.rows[a].bsRange,bsResult:t.data.rows[a].bsResult,bsSampleComment:t.data.rows[a].bsSampleComment,bsPartNo:e.formQuery.bsCode,bsSampleName:e.formQuery.bsName})})},addRowT:function(){1==this.formQuery.bsStatus?(this.bsQuery.bsName=this.formQuery.bsName,this.bsQuery.bsPartNo=this.formQuery.bsCode,this.selectlist()):(this.bsQuery.bsPartNo=this.formQuery.bsCode,this.selectlist())},getItem:function(){var e=this;this.bsQuery.bsPartNo=this.formQuery.bsCode,this.api.sampletesttime.selectlist(this.bsQuery).then(function(t){t.result?e.dialog.data1=t.data:e.$Message.error(t.msg)})},getData:function(){var e=this;this.formQu.id=this.$route.query.row.id,this.api.sample.selectById(this.formQu).then(function(t){t.result?(e.dialog.data=t.data,e.formQuery.bsQty=t.data.rows[0].bsQty,e.formQu.id=t.data.rows[0].id,e.formQuery.bsStatus=t.data.rows[0].bsStatus,e.formQuery.bsCode=t.data.rows[0].bsCode,e.formQuery.bsName=t.data.rows[0].bsName,e.formQuery.bsQty=t.data.rows[0].bsQty,e.formQuery.bsReportTime=t.data.rows[0].bsReportTime,e.addRowT()):e.$Message.error(t.msg)})},addRow:function(){this.dialog.datagrid.data.total=this.dialog.datagrid.data.total+1,this.dialog.datagrid.data.rows.push({testx:"",testTime:"",bsName:"",bsBaseline:"",bsBaselineDown:"",bsBaselineUp:"",bsBaseData:"",bsMeam:"",bsRange:"",bsResult:"",bsPartNo:this.formQuery.bsCode,bsSampleName:this.formQuery.bsName,bsSampleComment:this.formQuery.bsSampleComment})},removeRow:function(e){this.dialog.datagrid.data.rows.splice(e.index,1)},CompTime:function(){var e=this;this.api.sampleTest.selectTime(this.formQuery).then(function(t){""==t.data?(e.formQuery.id=e.formQuery.bsSampleStatrtTime.getTime(),e.api.sample.getTime(e.formQuery).then(function(t){e.formQuery.bsCompTime=t.data.bsSampleStatrtTime})):e.$Modal.confirm({title:"提示信息",content:"<p>开始时间存在别的样品</p>",loading:!0,onOk:function(){e.$Modal.remove()}})})},change:function(){this.CompTime()},cancel:function(){},saveTest:function(){var e=this;this.api.sample.updateStatus(this.formQuery).then(function(t){t.result?(e.dialog.datagrid.data.rows=[],e.getData(),e.show=!1):e.$Message.error(t.msg)})},cancel2:function(){this.formQuery.bsStatus=3,this.formQuery.id=this.formQu.id,this.saveTest(),this.dialog.modal_dialog3=!0},ok:function(){if(""==this.formQuery.bsCompTime||void 0==this.formQuery.bsCompTime)this.$Message.error("完成时间为空");else{this.formQuery.id=this.formQu.id,this.formQuery.bsReportTime=new Date(this.formQuery.bsReportTime),this.formQuery.bsCompTime=new Date(this.formQuery.bsCompTime);this.formQuery.bsCompTime.getTime()>this.formQuery.bsReportTime.getTime()?this.dialog.modal_dialog2=!0:(this.formQuery.bsStatus=1,this.saveTest(),this.saveData())}},saveData:function(){var e=this;this.api.sampleTest.saveData(this.formQuery).then(function(t){t.result?e.$Message.success("成功"):e.$Message.error("失败")})},To:function(){this.formQuery.id=this.formQu.id,this.formQuery.bsStatus=1,this.saveTest(),this.saveData()},saveTestx:function(){for(var e=0;e<this.dialog.datagrid.data.rows.length;e++)this.formQuery.ATime.push(this.dialog.datagrid.data.rows[e].testTime),this.formQuery.ATestx.push(this.dialog.datagrid.data.rows[e].testx),this.formQuery.AEqname.push(this.dialog.datagrid.data.rows[e].eqName);this.api.sample.saveTestx(this.formQuery)},from:function(){var e=this;this.formQuery.flag="testPerson",this.api.sample.sendMail(this.formQuery).then(function(t){t.result?e.$Message.success("发送邮件成功"):e.$Message.error("自动发送邮件失败，请手动发送")})},download:function(e){window.location.href="/admin/lab/sample/download?id="+e.row.id},saveExcel:function(){var e=this;this.bsQuery.bsName=this.formQuery.bsName,this.api.sampletesttime.saveExcel(this.bsQuery).then(function(t){t.result?e.$Message.success("实验数据Excel生成成功"):e.$Message.error("保存失败")})},saveReport:function(){var e=this;this.Query.bsCode=this.formQuery.bsCode,this.Query.bsName=this.formQuery.bsName,this.api.sampletesttime.saveReport(this.Query).then(function(t){t.result?e.$Message.success("实验报告Excel生成成功"):e.$Message.error("保存失败")})}}}},1886:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={props:{data:Object},data:function(){return{math:{maxValue:"",minValue:""},bsSampleComment:"",bsCode:"",result:"",sum:0,visible:!0,testxList:[],testx:"",testTime:0,bsName:"",bsNameList:[],arry:[],formQuery:{testx:"",bsName:"",bsPartNo:"",bsSampleName:""}}},created:function(){this.row=this.data.row,this.formQuery.bsPartNo=this.data.row.bsPartNo,this.formQuery.bsSampleName=this.data.row.bsSampleName,this.selectEableeBsName(),this.index=this.data.index},methods:{handleSubmit:function(){var e=this;if(this.arry=this.row.bsBaseData.split("/"),""!=this.arry){this.math.maxValue=Math.max.apply(null,this.arry),this.math.minValue=Math.min.apply(null,this.arry);for(var t=0;t<this.arry.length;t++)this.sum=this.sum+Number(this.arry[t]);Number(this.math.maxValue)<=Number(this.row.bsBaselineUp)&&Number(this.math.minValue)>=Number(this.row.bsBaselineDown)?(this.row.bsResult="OK",this.data.bsResult="OK"):(this.row.bsResult="NG",this.data.bsResult="NG"),this.data.bsMean=this.sum/this.arry.length,this.data.bsRange=Number(this.math.maxValue)-Number(this.math.minValue),this.row.bsMean=Number(this.data.bsMean).toFixed(3),this.row.bsRange=Number(this.data.bsRange).toFixed(4),this.arry=[]}else this.row.bsResult="",this.row.bsMean="",this.row.bsRange="",this.arry=[];""!=this.row.testx&&void 0!=this.row.testx&&""!=this.row.bsName&&void 0!=this.row.bsName?this.api.sampletesttime.save(this.row).then(function(t){t.result&&e.$Message.success("保存成功")}):this.$Message.error("请正确填写信息"),this.$emit("returnadd",this.data)},handleCancel:function(){this.$emit("returncancle",this.data)},deleteData:function(){var e=this;this.$Modal.confirm({title:"提示信息",content:"<p>是否将这条数据从数据库中删除？</p>",loading:!0,onOk:function(){e.api.sampletesttime.deleteData(e.row).then(function(t){t.result?(e.$emit("getRowLoad",e.data),e.$Message.info("删除成功"),e.$Modal.remove()):e.$Message.error("删除失败")})}})},selectTestx:function(){var e=this;this.api.equipmenttime.selectTestx(this.formQuery).then(function(t){t.result&&(e.testxList=t.data)})},selectEableeBsName:function(){var e=this;this.formQuery.testx=this.row.testx,this.bsNameList=[],this.api.equipment.selectEablee(this.formQuery).then(function(t){t.result?e.bsNameList=t.data:e.$Message.error("查询有错")})},changeEqName:function(){var e=this;this.formQuery.testx=this.row.testx,this.formQuery.bsName=this.row.bsName,void 0!=this.formQuery.bsName&&""!=this.formQuery.bsName&&this.api.equipmenttime.selectTestTime(this.formQuery).then(function(t){t.result?(e.row.testTime=0,e.row.testTime=t.data.rows[0].testTime):e.$Message.error("查询有误")})}}}},2051:function(e,t,a){var s=a(2052);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a(19)("c2066222",s,!1)},2052:function(e,t,a){t=e.exports=a(18)(!1),t.push([e.i,"\nInput{\n    display:float;\n    width:25%;\n}\nSelect{\n    display:float;\n    width:25%;\n}   \n",""])},2053:function(e,t,a){"use strict";function s(e){m||a(2054)}Object.defineProperty(t,"__esModule",{value:!0});var r=a(1886),i=a.n(r);for(var o in r)"default"!==o&&function(e){a.d(t,e,function(){return r[e]})}(o);var l=a(2056),n=a.n(l),m=!1,u=a(1),d=s,b=u(i.a,n.a,!1,d,"data-v-649df5a8",null);b.options.__file="src/view/member/lab/sample/table-expand.vue",t.default=b.exports},2054:function(e,t,a){var s=a(2055);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a(19)("386d0001",s,!1)},2055:function(e,t,a){t=e.exports=a(18)(!1),t.push([e.i,"\n.expand-row[data-v-649df5a8]{\n    margin-bottom: 0px;\n}\n",""])},2056:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Form",{attrs:{"label-width":80}},[a("Row",{staticClass:"expand-row"},[a("Col",{attrs:{span:"8"}},[a("Form-item",{attrs:{label:"测试项"}},[a("Input",{attrs:{placeholder:"请输入..."},model:{value:e.row.testx,callback:function(t){e.$set(e.row,"testx",t)},expression:"row.testx"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"8"}},[a("Form-item",{attrs:{label:"可用设备"}},[a("Select",{model:{value:e.row.bsName,callback:function(t){e.$set(e.row,"bsName",t)},expression:"row.bsName"}},e._l(e.bsNameList,function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])}))],1)],1),e._v(" "),a("Col",{attrs:{span:"8"}},[a("Form-item",{attrs:{label:"测试时间"}},[a("Input",{attrs:{placeholder:"请输入..."},model:{value:e.row.testTime,callback:function(t){e.$set(e.row,"testTime",t)},expression:"row.testTime"}})],1)],1)],1),e._v(" "),a("Row",{staticClass:"expand-row"},[a("Col",{attrs:{span:"8"}},[a("Form-item",{attrs:{label:"Nominal Spec基准值"}},[a("Input",{attrs:{placeholder:"请输入..."},model:{value:e.row.bsBaseline,callback:function(t){e.$set(e.row,"bsBaseline",t)},expression:"row.bsBaseline"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"8"}},[a("Form-item",{attrs:{label:"USL+上限值"}},[a("Input",{attrs:{placeholder:"请输入..."},model:{value:e.row.bsBaselineUp,callback:function(t){e.$set(e.row,"bsBaselineUp",t)},expression:"row.bsBaselineUp"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"8"}},[a("Form-item",{attrs:{label:"USL+下限值"}},[a("Input",{attrs:{placeholder:"请输入..."},model:{value:e.row.bsBaselineDown,callback:function(t){e.$set(e.row,"bsBaselineDown",t)},expression:"row.bsBaselineDown"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"12"}},[a("Form-item",{attrs:{label:"测试数据"}},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.row.bsBaseData,expression:"row.bsBaseData"}],staticStyle:{width:"500px"},attrs:{placeholder:"请输入..."},domProps:{value:e.row.bsBaseData},on:{input:function(t){t.target.composing||e.$set(e.row,"bsBaseData",t.target.value)}}})])],1),e._v(" "),a("Col",{attrs:{span:"12"}},[a("Form-item",{attrs:{label:"备注"}},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.row.bsSampleComment,expression:"row.bsSampleComment"}],staticStyle:{width:"500px"},attrs:{placeholder:"请输入..."},domProps:{value:e.row.bsSampleComment},on:{input:function(t){t.target.composing||e.$set(e.row,"bsSampleComment",t.target.value)}}})])],1),e._v(" "),a("Col",{attrs:{span:"8"}},[e._e()],1),e._v(" "),a("Col",{attrs:{span:"8"}},[e._e()],1),e._v(" "),a("Col",{attrs:{span:"8"}},[e._e()],1)],1),e._v(" "),a("Row",[e.visible?a("Col",{attrs:{span:"24",align:"center"}},[a("Button",{attrs:{type:"primary",size:"small"},on:{click:e.handleCancel}},[e._v("取 消")]),e._v("    \n            "),a("Button",{attrs:{type:"primary",size:"small"},on:{click:e.handleSubmit}},[e._v("保 存")]),e._v("    \n            "),a("Button",{attrs:{type:"primary",size:"small"},on:{click:e.deleteData}},[e._v("删除数据")])],1):e._e()],1)],1)],1)},r=[];s._withStripped=!0;var i={render:s,staticRenderFns:r};t.default=i},2057:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Row",[a("Modal",{attrs:{title:""},on:{"on-ok":e.To,"on-cancel":e.cancel2},model:{value:e.dialog.modal_dialog2,callback:function(t){e.$set(e.dialog,"modal_dialog2",t)},expression:"dialog.modal_dialog2"}},[a("p",[a("Form",{attrs:{model:e.dialog.formQuery,"label-width":80}},[a("Form-item",{attrs:{label:"",prop:"bsCode"}},[a("p",[e._v("在规定时间内完不成是否仍然继续测试")])])],1)],1)])],1),e._v(" "),a("Row",[a("Modal",{attrs:{title:""},on:{"on-ok":e.from,"on-cancel":e.cancel},model:{value:e.dialog.modal_dialog3,callback:function(t){e.$set(e.dialog,"modal_dialog3",t)},expression:"dialog.modal_dialog3"}},[a("p",[a("Form",{attrs:{model:e.dialog.formQuery,"label-width":80}},[a("Form-item",{attrs:{label:"",prop:"bsCode"}},[a("a",{attrs:{href:"mailto:haorooms@126.com?subject=样品测试结果"}},[e._v("点击发送邮件或者点击确定自动发送邮件")])])],1)],1)])],1),e._v(" "),a("Row",[a("i-col",{attrs:{span:"24"}},[a("Table",{staticStyle:{height:"100px"},attrs:{data:e.dialog.data.rows,columns:e.dialog.columns,stripe:""}})],1)],1),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("Row",[a("i-col",{attrs:{span:"12"}},[a("Button",{attrs:{type:"primary",size:"small"},on:{click:e.addRow}},[e._v("添加测试项")]),e._v("  \n                    ")],1),e._v(" "),a("i-col",{attrs:{span:"12"}})],1),e._v(" "),a("Row",[a("i-col",{attrs:{span:"24"}},[a("Table",{ref:"dialogTable",attrs:{data:e.dialog.datagrid.data.rows,"highlight-row":"",columns:e.dialog.datagrid.columns,stripe:"",height:"auto"}}),e._v(" "),a("br"),e._v(" "),0==this.formQuery.bsStatus?a("div",[a("div",{staticStyle:{display:"inline"}},[e._v("                       \n                            总用时：\n                            "),a("Input",{attrs:{disabled:"disabled",placeholder:"请输入..."},model:{value:e.formQuery.bsCostTime,callback:function(t){e.$set(e.formQuery,"bsCostTime",t)},expression:"formQuery.bsCostTime"}})],1),e._v(" "),a("br"),a("br"),e._v(" "),a("div",{staticStyle:{width:"50%",float:"left"}},[e._v("\n                        开始实验时间\n                        "),a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"datetime",placeholder:"请选择"},on:{"on-change":e.change},model:{value:e.formQuery.bsSampleStatrtTime,callback:function(t){e.$set(e.formQuery,"bsSampleStatrtTime",t)},expression:"formQuery.bsSampleStatrtTime"}})],1),e._v(" "),a("div",{staticStyle:{width:"50%",float:"left"}},[e._v("    \n                        预计完成时间：\n                        "),a("DatePicker",{staticStyle:{width:"200px"},attrs:{readonly:"readonly",type:"datetime",placeholder:"请选择"},model:{value:e.formQuery.bsCompTime,callback:function(t){e.$set(e.formQuery,"bsCompTime",t)},expression:"formQuery.bsCompTime"}})],1),e._v(" "),a("br"),a("br"),a("br"),e._v(" "),a("div",[e._v("    \n                        测试人员：\n                            "),a("Input",{attrs:{type:"text",placeholder:"请输入测试人员..."},model:{value:e.formQuery.pkPerson,callback:function(t){e.$set(e.formQuery,"pkPerson",t)},expression:"formQuery.pkPerson"}})],1)]):e._e(),e._v(" "),a("br"),a("br"),e._v(" "),0==this.formQuery.bsStatus?a("div",[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.ok()}}},[e._v("开始测试")])],1):e._e(),e._v(" "),a("br"),a("br"),e._v(" "),0!=this.formQuery.bsStatus?a("div",{staticStyle:{float:"left"}},[a("Button",{attrs:{type:"primary"},on:{click:e.saveExcel}},[e._v("保存实验数据excel")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:e.saveReport}},[e._v("saveReport")])],1):e._e()],1)],1)],1)},r=[];s._withStripped=!0;var i={render:s,staticRenderFns:r};t.default=i}});