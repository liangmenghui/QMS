webpackJsonp([18],{1149:function(t,e,a){"use strict";function o(t){m||a(2017)}Object.defineProperty(e,"__esModule",{value:!0});var r=a(1728),s=a.n(r);for(var i in r)"default"!==i&&function(t){a.d(e,t,function(){return r[t]})}(i);var n=a(2023),l=a.n(n),m=!1,d=a(1),u=o,c=d(s.a,l.a,!1,u,null,null);c.options.__file="src/view/member/lab/sample/checkin.vue",e.default=c.exports},1728:function(t,e,a){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=a(98),s=o(r),i=a(3),n=o(i),l=a(16),m=o(l),d=a(97),u=a(2019),c=o(u);e.default={data:function(){var t,e=this;return{show:!0,dialog:(t={data:{rows:[],total:0},modal_dialog:!1,modal_dialog2:!1,modal_dialog4:!1,testx:[],datagrid:{data:{rows:[],total:0},columns:[{type:"expand",key:"bsCode",align:"center",render:function(t,a){return t(c.default,{props:{data:a},on:{returnadd:function(t){var a=t.index;t.row;(0,m.default)(e.dialog.datagrid.data.rows[a],t.row),e.formQuery.bsCostTime=0;for(var o=0;o<e.dialog.datagrid.data.rows.length;o++)e.formQuery.bsCostTime+=Number(e.dialog.datagrid.data.rows[o].testTime)*Number(e.formQuery.bsQty);e.CompTime()},returncancle:function(t){var a=t.index;e.$refs.dialogTable.toggleExpand(a)}}})}},{title:"测试项",key:"testx"},{title:"测试设备",key:"eqName"},{title:"测试时间",key:"testTime"},{title:"操作",key:"action",width:150,align:"center",render:function(t,a){return t("div",[t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.removeRow(a)}}},"移除行")])}}]},queryParams:{page:1,rows:25,pkParent:-1},dict:{bsStatus:[{value:0,name:"待测试"},{value:1,name:"测试中"},{value:2,name:"已完成"},{value:3,name:"已中止"}]},pagination:[25,50,100]},(0,n.default)(t,"data",{rows:[],total:0}),(0,n.default)(t,"columns",[{title:"样品编码",key:"bsCode"},{title:"样品名称",key:"bsName"},{title:"登记时间",key:"bsSampleTime"},{title:"要求报告时间",key:"bsReportTime"},{title:"样品数量",key:"bsQty"},{title:"状态",key:"bsStatus",render:function(t,a){return t("span",e.dialog.dict.bsStatus[a.row.bsStatus].name)}},{title:"测试内容",key:"bsComment"}]),(0,n.default)(t,"modal_dialog",!1),(0,n.default)(t,"modal_dialog1",!1),t),formQuery:{eqName:"",testx:"",bsSampleStatrtTime:"",bsCostTime:0,bsCode:"",bsName:"",bsReportTime:"",bsSampleTime:"",bsComment:"",bsQty:"",bsCompTime:"",bjsj:"",pkPerson:"",bsStatus:0,ATestx:[],ATime:[],AEqname:[]},Query:{bsName:"",bsCode:""},formQu:{id:""}}},computed:(0,s.default)({},(0,d.mapState)({menuData:function(t){return t.menuData}})),created:function(){this.formQuery.bsSampleStatrtTime=new Date,this.getData()},methods:{getData:function(){var t=this;this.formQu.id=this.$route.query.row.id,this.api.sample.selectById(this.formQu).then(function(e){e.result?(t.dialog.data=e.data,t.formQuery.bsQty=e.data.rows[0].bsQty,t.formQu.id=e.data.rows[0].id,t.formQuery.bsStatus=e.data.rows[0].bsStatus,t.formQuery.bsCode=e.data.rows[0].bsCode,t.formQuery.bsName=e.data.rows[0].bsName,t.formQuery.bsQty=e.data.rows[0].bsQty,t.formQuery.bsReportTime=e.data.rows[0].bsReportTime):t.$Message.error(e.msg)})},addRow:function(){this.dialog.datagrid.data.total=this.dialog.datagrid.data.total+1,this.dialog.datagrid.data.rows.push({testx:"",testTime:"",eqName:""})},removeRow:function(t){this.dialog.datagrid.data.rows.splice(t.index,1)},CompTime:function(){var t=this;this.api.sample.selectall().then(function(e){0==e.data.total?(t.formQuery.id=t.formQuery.bsSampleStatrtTime.getTime(),t.api.sample.getTime(t.formQuery).then(function(e){t.formQuery.bsCompTime=e.data.bsSampleStatrtTime})):(t.formQuery.bjsj=e.data.rows[0].bsCompTime,t.formQuery.bjsj=new Date(t.formQuery.bjsj),t.formQuery.bjsj.getTime()>t.formQuery.bsSampleStatrtTime.getTime()?t.$Modal.confirm({title:"提示信息",content:"<p>开始时间存在别的样品</p>",loading:!0,onOk:function(){t.$Modal.remove()}}):(t.formQuery.id=t.formQuery.bsSampleStatrtTime.getTime(),t.api.sample.getTime(t.formQuery).then(function(e){t.formQuery.bsCompTime=e.data.bsSampleStatrtTime})))})},change:function(){this.CompTime()},cancel:function(){},saveTest:function(){var t=this;this.api.sample.saveTest(this.formQuery).then(function(e){t.getData(),t.saveTestx(),t.show=!t.show})},cancel2:function(){this.formQuery.bsStatus=3,this.formQuery.id=this.formQu.id,this.saveTest(),this.dialog.modal_dialog3=!0},ok:function(){this.formQuery.id=this.formQu.id,this.formQuery.bsReportTime=new Date(this.formQuery.bsReportTime),this.formQuery.bsCompTime.getTime()>this.formQuery.bsReportTime.getTime()?this.dialog.modal_dialog2=!0:(this.formQuery.bsStatus=1,this.saveTest())},To:function(){this.formQuery.id=this.formQu.id,this.formQuery.bsStatus=1,this.saveTest()},saveTestx:function(){for(var t=0;t<this.dialog.datagrid.data.rows.length;t++)this.formQuery.ATime.push(this.dialog.datagrid.data.rows[t].testTime),this.formQuery.ATestx.push(this.dialog.datagrid.data.rows[t].testx),this.formQuery.AEqname.push(this.dialog.datagrid.data.rows[t].eqName);this.api.sample.saveTestx(this.formQuery)},from:function(){}}}},1729:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:{data:Object},data:function(){return{visible:!0,testxList:[],testx:"",testTime:0,eqName:"",eqNameList:[],formQuery:{testx:"",eqName:""}}},created:function(){this.row=this.data.row,this.selectTest(),this.index=this.data.index},methods:{handleSubmit:function(){this.$emit("returnadd",this.data)},handleCancel:function(){this.$emit("returncancle",this.data)},selectTest:function(){var t=this;this.api.equipment.selectTest().then(function(e){e.result&&(t.testxList=e.data.rows)})},changeTestx:function(){var t=this;this.formQuery.testx=this.row.testx,this.eqNameList=[],this.api.equipment.selectEablee(this.formQuery).then(function(e){if(0==e.data.total)t.$Message.error("这个测试项的设备处于不可用状态！");else{for(var a=0;a<e.data.rows.length;a++)t.eqNameList.push(e.data.rows[a].eqName);t.changeEqName()}})},changeEqName:function(){var t=this;this.formQuery.testx=this.row.testx,this.formQuery.eqName=this.row.eqName,void 0!=this.formQuery.eqName&&""!=this.formQuery.eqName&&this.api.equipment.selectTime(this.formQuery).then(function(e){e.result?(t.row.testTime=0,t.row.testTime=e.data.rows[0].testTime):t.$Message.error("查询有误")})}}}},2017:function(t,e,a){var o=a(2018);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);a(29)("c2066222",o,!1)},2018:function(t,e,a){e=t.exports=a(28)(!1),e.push([t.i,"\nInput{\n    display:float;\n    width:25%;\n}\nSelect{\n    display:float;\n    width:25%;\n}   \n",""])},2019:function(t,e,a){"use strict";function o(t){m||a(2020)}Object.defineProperty(e,"__esModule",{value:!0});var r=a(1729),s=a.n(r);for(var i in r)"default"!==i&&function(t){a.d(e,t,function(){return r[t]})}(i);var n=a(2022),l=a.n(n),m=!1,d=a(1),u=o,c=d(s.a,l.a,!1,u,"data-v-649df5a8",null);c.options.__file="src/view/member/lab/sample/table-expand.vue",e.default=c.exports},2020:function(t,e,a){var o=a(2021);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);a(29)("386d0001",o,!1)},2021:function(t,e,a){e=t.exports=a(28)(!1),e.push([t.i,"\n.expand-row[data-v-649df5a8]{\n    margin-bottom: 0px;\n}\n",""])},2022:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Form",{attrs:{"label-width":80}},[a("Row",{staticClass:"expand-row"},[a("Col",{attrs:{span:"8"}},[a("Form-item",{attrs:{label:"测试项"}},[a("Select",{on:{"on-change":t.changeTestx},model:{value:t.row.testx,callback:function(e){t.$set(t.row,"testx",e)},expression:"row.testx"}},t._l(t.testxList,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}))],1)],1),t._v(" "),a("Col",{attrs:{span:"8"}},[a("Form-item",{attrs:{label:"可用设备"}},[a("Select",{on:{"on-change":t.changeEqName},model:{value:t.row.eqName,callback:function(e){t.$set(t.row,"eqName",e)},expression:"row.eqName"}},t._l(t.eqNameList,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}))],1)],1),t._v(" "),a("Col",{attrs:{span:"8"}},[a("Form-item",{attrs:{label:"测试时间"}},[a("Input",{attrs:{placeholder:"请输入...",readonly:"readonly"},model:{value:t.row.testTime,callback:function(e){t.$set(t.row,"testTime",e)},expression:"row.testTime"}})],1)],1)],1),t._v(" "),a("Row",[t.visible?a("Col",{attrs:{span:"24",align:"center"}},[a("Button",{attrs:{type:"primary",size:"small"},on:{click:t.handleCancel}},[t._v("取 消")]),t._v("       \n            "),a("Button",{attrs:{type:"primary",size:"small"},on:{click:t.handleSubmit}},[t._v("保 存")])],1):t._e()],1)],1)],1)},r=[];o._withStripped=!0;var s={render:o,staticRenderFns:r};e.default=s},2023:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",[a("Modal",{attrs:{title:""},on:{"on-ok":t.To,"on-cancel":t.cancel2},model:{value:t.dialog.modal_dialog2,callback:function(e){t.$set(t.dialog,"modal_dialog2",e)},expression:"dialog.modal_dialog2"}},[a("p",[a("Form",{attrs:{model:t.dialog.formQuery,"label-width":80}},[a("Form-item",{attrs:{label:"",prop:"bsCode"}},[a("p",[t._v("在规定时间内完不成是否仍然继续测试")])])],1)],1)])],1),t._v(" "),a("Row",[a("Modal",{attrs:{title:""},on:{"on-ok":t.from,"on-cancel":t.cancel},model:{value:t.dialog.modal_dialog3,callback:function(e){t.$set(t.dialog,"modal_dialog3",e)},expression:"dialog.modal_dialog3"}},[a("p",[a("Form",{attrs:{model:t.dialog.formQuery,"label-width":80}},[a("Form-item",{attrs:{label:"",prop:"bsCode"}},[a("a",{attrs:{href:"mailto:haorooms@126.com?subject=样品测试结果"}},[t._v("点击发送邮件")])])],1)],1)])],1),t._v(" "),a("Row",[a("i-col",{attrs:{span:"24"}},[a("Table",{staticStyle:{height:"100px"},attrs:{data:t.dialog.data.rows,columns:t.dialog.columns,stripe:""}})],1)],1),t._v(" "),a("br"),t._v(" "),a("br"),t._v(" "),a("Row",[a("i-col",{attrs:{span:"12"}},[a("Button",{attrs:{type:"primary",size:"small"},on:{click:t.addRow}},[t._v("添加测试项")]),t._v("  \n                    ")],1),t._v(" "),a("i-col",{attrs:{span:"12"}})],1),t._v(" "),a("Row",[a("i-col",{attrs:{span:"24"}},[a("Table",{ref:"dialogTable",attrs:{data:t.dialog.datagrid.data.rows,"highlight-row":"",columns:t.dialog.datagrid.columns,stripe:"",height:"auto"}}),t._v(" "),a("br"),t._v(" "),a("div",{staticStyle:{display:"inline"}},[t._v("                       \n                            总用时：\n                            "),a("Input",{attrs:{disabled:"disabled",placeholder:"请输入..."},model:{value:t.formQuery.bsCostTime,callback:function(e){t.$set(t.formQuery,"bsCostTime",e)},expression:"formQuery.bsCostTime"}})],1),t._v(" "),a("br"),a("br"),t._v(" "),a("div",{staticStyle:{width:"50%",float:"left"}},[t._v("\n                        开始实验时间\n                        "),a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"datetime",placeholder:"请选择"},on:{"on-change":t.change},model:{value:t.formQuery.bsSampleStatrtTime,callback:function(e){t.$set(t.formQuery,"bsSampleStatrtTime",e)},expression:"formQuery.bsSampleStatrtTime"}})],1),t._v(" "),a("div",{staticStyle:{width:"50%",float:"left"}},[t._v("    \n                        预计完成时间：\n                        "),a("DatePicker",{staticStyle:{width:"200px"},attrs:{readonly:"readonly",type:"datetime",placeholder:"请选择"},model:{value:t.formQuery.bsCompTime,callback:function(e){t.$set(t.formQuery,"bsCompTime",e)},expression:"formQuery.bsCompTime"}})],1),t._v(" "),a("br"),a("br"),a("br"),t._v(" "),a("div",[t._v("    \n                        测试人员：\n                            "),a("Input",{attrs:{type:"text",placeholder:"请输入测试人员..."},model:{value:t.formQuery.pkPerson,callback:function(e){t.$set(t.formQuery,"pkPerson",e)},expression:"formQuery.pkPerson"}})],1),t._v(" "),a("br"),a("br"),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}]},[a("Button",{attrs:{type:"primary"},on:{click:function(e){t.ok()}}},[t._v("开始测试")])],1)],1)],1)],1)},r=[];o._withStripped=!0;var s={render:o,staticRenderFns:r};e.default=s}});