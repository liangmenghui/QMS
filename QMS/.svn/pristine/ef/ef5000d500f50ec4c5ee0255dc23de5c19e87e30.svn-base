webpackJsonp([85],{1182:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o(1765),s=o.n(a);for(var i in a)"default"!==i&&function(t){o.d(e,t,function(){return a[t]})}(i);var n=o(2071),r=o.n(n),l=o(1),m=l(s.a,r.a,!1,null,null,null);m.options.__file="src/view/logistics/booking/template.vue",e.default=m.exports},1765:function(t,e,o){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(44),i=a(s),n=(o(97),o(45));a(n);e.default={data:function(){return{customers:[{customer:"",desc:"请选择客户"}],agents:[{agent:"",name:name,url:"",desc:"请选择货代"}],uploadState:!1,file:null,templatePath:"",form:{customer:"",agent:void 0}}},created:function(){this.$nextTick(function(){this.loadCustomers(),this.loadPageView()})},methods:{save:function(t){var e=this,o=[];(0,i.default)(t).forEach(function(e){o.push({key:e,value:t[e]})}),o.push({key:"customer",value:this.form.customer}),o.push({key:"agent",value:this.form.agent}),this.api.lmp.booking.saveList(o).then(function(t){t.result&&e.$Message.success("保存成功")})},handsubmit:function(){this.$store.commit("setBookingTemplateCommitState",1)},loadPageView:function(){var t=this,e="",o="";if(void 0==this.form.agent||0==this.form.agent.length)return void this.$router.replace("/lmp/booking/template/empty");console.log("......1111 "),(0,i.default)(this.agents).forEach(function(a){t.agents[a].agent==t.form.agent&&(o=t.agents[a].url,e=t.agents[a].name)}),void 0!==o&&o.length>0&&(o=o+"/"+this.form.customer+"/"+this.form.agent,this.$router.replace(o))},loadCustomers:function(){var t=this;this.customers=[{customer:"",desc:"请选择客户"}],void 0==this.form.customer||this.form.customer.length,this.api.lmp.booking.customers().then(function(e){if(e.result){var o=[{customer:"",desc:"请选择客户"}];e.data.forEach(function(t){o.push({customer:t.bsAccountNumber,desc:t.bsPartyName})}),t.customers=o}})},loadAgents:function(){var t=this;this.agents=[{agent:"",name:name,url:"",desc:"请选择货代"}],void 0==this.form.agent||this.form.agent.length,this.api.lmp.booking.agents({customer:this.form.customer}).then(function(e){if(e.result){var o=[{agent:"",name:name,url:"",desc:"请选择货代"}];e.data.forEach(function(t){o.push({agent:t.bsAgent,desc:t.bsAgentDesc,url:t.bsTemplateComponentUrl,name:t.bsTemplateComponent})}),t.agents=o}})},handleUpload:function(t){return 1==this.uploadState?(this.$message.warning("正在处理上传文件，请稍后再试..."),!1):(this.file=null,this.templatePath="",void 0===this.form.customer||0==this.form.customer.length||void 0===this.form.agent||0==this.form.agent.length?(this.$Message.error("请先选择客户和货代。"),!1):(this.file=t,this.templatePath=t.name,this.uploadState=!0,!0))},handleLoadTemplate:function(){var t=this;if(void 0===this.form.customer||0==this.form.customer.length||void 0===this.form.agent||0==this.form.agent.length)return this.$Message.error("请先选择客户和货代。"),!1;this.api.lmp.booking.getTemplate({customer:this.form.customer,agent:this.form.agent}).then(function(e){if(e.result){var o={};e.data.forEach(function(t){o[t.bsName]=t.bsValue}),t.$store.commit("setBookingTemplateFormData",o),t.templatePath=o.template}else t.$Message.error(e.message)})},handleDownload:function(){if(void 0===this.form.customer||0==this.form.customer.length||void 0===this.form.agent||0==this.form.agent.length)return this.$Message.error("请先选择客户和货代。"),!1;this.api.lmp.booking.download({customer:this.form.customer,agent:this.form.agent})},handleUploadSuccess:function(t,e){if(1==t.result){var o={};t.data.forEach(function(t){o[t.bsName]=t.bsValue}),this.$store.commit("setBookingTemplateFormData",o),this.$Message.info("文件"+e.name+"上传成功.")}else this.$message.error(t.msg);this.uploadState=!1},handleUploadError:function(t,e){this.$message.error("文件"+e.name+"上传失败。"),this.uploadState=!1},handleFormatError:function(t){this.$Message.error("模板格式错误,请上传正确的Booking文档模板。")},loadTemplateData:function(){if(0!=this.$store.getters.bookingTemplateCommitState){this.$store.commit("setBookingTemplateCommitState",0);var t=this.$store.getters.bookingTemplateFormData;null==t&&void 0==t||this.save(t)}}},directives:{},mounted:function(){this.loadCustomers(),this.$store.commit("setBookingTemplateCommitState",0)},computed:{commitData:function(){return this.$store.getters.bookingTemplateFormData},formCustomer:function(){return this.form.customer},formAgent:function(){return this.form.agent}},watch:{formCustomer:function(){this.loadAgents()},formAgent:function(){this.loadPageView()},commitData:function(){this.loadTemplateData()}}}},2071:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("Row",[o("i-col",{attrs:{span:"24"}},[o("Form",{staticStyle:{"min-height":"720px"},attrs:{model:t.form,"label-width":120}},[o("div",{staticStyle:{padding:"0 0 24px","line-height":"32px","font-size":"12px"}},[o("div",{staticStyle:{display:"inline-block"}},[o("p",{staticStyle:{width:"100px",display:"inline-block","text-align":"right","margin-right":"20px"}},[t._v("客户")]),t._v(" "),o("Select",{staticStyle:{width:"200px"},model:{value:t.form.customer,callback:function(e){t.$set(t.form,"customer",e)},expression:"form.customer"}},t._l(t.customers,function(e){return o("Option",{key:e.customer,attrs:{value:e.customer}},[t._v(t._s(e.desc))])}))],1),t._v(" "),o("div",{staticStyle:{display:"inline-block"}},[o("p",{staticStyle:{width:"100px",display:"inline-block","text-align":"right","margin-right":"20px"}},[t._v("货代")]),t._v(" "),o("i-select",{staticStyle:{width:"200px"},model:{value:t.form.agent,callback:function(e){t.$set(t.form,"agent",e)},expression:"form.agent"}},t._l(t.agents,function(e){return o("Option",{key:e.agent,attrs:{value:e.agent}},[t._v(t._s(e.desc))])}))],1),t._v(" "),o("div",{staticStyle:{float:"right"}},[o("Button",{staticStyle:{float:"right","margin-right":"20px"},attrs:{type:"primary",icon:"ios-loop-strong"},on:{click:t.handleLoadTemplate}},[t._v("加载模板")])],1)]),t._v(" "),o("form-item",{attrs:{label:"Booking模板"}},[o("div",{staticStyle:{"margin-right":"140px"}},[o("i-input",{attrs:{disabled:""},model:{value:t.templatePath,callback:function(e){t.templatePath=e},expression:"templatePath"}})],1),t._v(" "),o("Upload",{staticStyle:{float:"right","margin-right":"20px","margin-top":"-34px"},attrs:{action:"/admin/lmp/booking/template/upload","show-upload-list":!1,"before-upload":t.handleUpload,"on-format-error":t.handleFormatError,data:{customer:this.form.customer,agent:this.form.agent},"on-success":t.handleUploadSuccess,"on-error":t.handleUploadError,format:["xls","xlsx"]}},[o("i-button",{attrs:{type:"primary",loading:this.uploadState,icon:"ios-cloud-upload-outline"}},[t._v(t._s(this.uploadState?"上传中":"上传模板"))])],1)],1),t._v(" "),o("form-item",{attrs:{label:"模板详细信息"}},[o("router-view")],1)],1)],1)],1),t._v(" "),o("Row",[o("i-col",{attrs:{span:"24"}},[o("div",{staticStyle:{height:"86px","padding-top":"24px","background-color":"#f1f2f3"}},[o("Button",{staticStyle:{float:"right","margin-right":"60px"},attrs:{type:"success",size:"large"},on:{click:t.handsubmit}},[t._v("保存")])],1)])],1)],1)},s=[];a._withStripped=!0;var i={render:a,staticRenderFns:s};e.default=i}});