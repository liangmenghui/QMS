webpackJsonp([56],{1154:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(1734),r=o.n(a);for(var l in a)"default"!==l&&function(e){o.d(t,e,function(){return a[e]})}(l);var s=o(2030),i=o.n(s),n=o(1),d=n(r.a,i.a,!1,null,null,null);d.options.__file="src/view/member/user/index.vue",t.default=d.exports},1734:function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=o(30),l=a(r),s=o(19),i=a(s),n=o(16),d=a(n),m=o(98),u=a(m),c=o(97);t.default={data:function(){var e=this;return{groups:[],orgs:[],formQuery:{bsCode:"",bsName:""},roles:{modal_dialog:!1,formItem:{},tree:{alloced:[{expand:!0,title:"根目录",children:[]}],unalloced:[{expand:!0,title:"根目录",children:[]}]}},dialog:{modal_dialog:!1,formItem:{},ruleForm:{bsCode:[{required:!0,message:"请填写帐号",trigger:"blur"}],bsName:[{required:!0,message:"请填写姓名",trigger:"blur"}]}},datagrid:{queryParams:{page:1,rows:25,bsIsDel:0},pagination:[25,50,100],data:{rows:[],total:0},columns:[{title:"集团",key:"bsGroupName",render:function(e,t){if(t.row.group)return e("span",t.row.group.bsName)}},{title:"组织",key:"bsOrgName",render:function(e,t){if(t.row.org)return e("span",t.row.org.bsName)}},{title:"帐号",key:"bsCode"},{title:"姓名",key:"bsName"},{title:"手机号",key:"bsMobile"},{title:"邮箱",key:"bsEmail"},{title:"状态",key:"bsStatus",render:function(e,t){var o=void 0;return 1==t.row.bsStatus?o="启用":2==t.row.bsStatus?o="停用":3==t.row.bsStatus&&(o="锁定"),e("span",o)}},{title:"删除标识",key:"bsIsDel",render:function(e,t){var o=void 0;return 0==t.row.bsIsDel?o="-":1==t.row.bsIsDel&&(o="已删除"),e("span",o)}},{title:"创建时间",key:"bsCreatedTime"},{title:"更新时间",key:"bsModifiedTime"},{title:"操作",key:"action",render:function(t,o){var a=[];return e.menuData.perms.ALLOC&&a.push(t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.showAllocDialog(o)}}},"分配角色")),e.menuData.perms.EDIT&&a.push(t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.showEditDialog(o)}}},"编辑")),e.menuData.perms.DELETE&&a.push(t("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.delete(o)}}},"删除")),t("div",a)}}]}}},created:function(){this.getGroupList()},computed:(0,u.default)({},(0,c.mapState)({menuData:function(e){return e.menuData}})),methods:{getGroupList:function(){var e=this;this.api.admin.group.getlist({}).then(function(t){console.log("get list===>"),console.log(t.data),t.result?e.groups=t.data.rows:e.$Message.error(t.msg)})},getOrgList:function(e){var t=this;this.api.admin.organization.getlist({pkGroup:e}).then(function(e){console.log("get list===>"),console.log(e.data),e.result?t.orgs=e.data.rows:t.$Message.error(e.msg)})},handleSubmit:function(e){this.getData()},getData:function(){var e=this;(0,d.default)(this.formQuery,this.datagrid.queryParams),console.log("after===>"),console.log(this.formQuery),this.api.admin.user.getlist(this.formQuery).then(function(t){console.log("get list===>"),console.log(t.data),t.result?e.datagrid.data=t.data:e.$Message.error(t.msg)})},reloadData:function(){this.datagrid.data=this.getData()},changePage:function(e){this.datagrid.queryParams.page=e,this.datagrid.data=this.getData()},edit:function(e){var t=this;console.log(e),this.api.admin.user.edit(e.row).then(function(e){console.log(e),e.result?t.reloadData():t.$Message.error(e.msg)})},delete:function(e){var t=this;console.log(e),this.$Modal.confirm({title:"提示信息",content:"<p>是否确定删除？</p>",loading:!0,onOk:function(){t.api.admin.user.delete({id:e.row.id}).then(function(e){console.log(e),e.result?(t.reloadData(),t.$Message.info("删除成功"),t.$Modal.remove()):t.$Message.error(e.msg)})}})},showAddDialog:function(){this.dialog.modal_dialog=!0,this.dialog.formItem={}},showEditDialog:function(e){this.dialog.modal_dialog=!0;var t=e.row;this.dialog.formItem={pkGroup:t.pkGroup,pkOrg:t.pkOrg,id:t.id,bsCode:t.bsCode,bsName:t.bsName,bsMobile:t.bsMobile,bsEmail:t.bsEmail,bsComment:t.bsComment}},ok:function(){var e=this;console.log("this.dialog.formItem====>"+(0,i.default)(this.dialog.formItem.id)),void 0!=(0,i.default)(this.dialog.formItem.id)&&"number"==typeof this.dialog.formItem.id?(console.log("编辑1"),console.log((0,l.default)(this.dialog.formItem)),this.api.admin.user.edit(this.dialog.formItem).then(function(t){t.result?e.reloadData():e.$Message.error(t.msg)})):(console.log("新增1"),this.api.admin.user.add(this.dialog.formItem).then(function(t){t.result?e.reloadData():e.$Message.error(t.msg)}))},cancel:function(){},getlist:function(e){var t=this;this.api.admin.userrole.getlist({pkUser:e}).then(function(e){e.result&&(console.log("Tree.."),console.log((0,l.default)(e.data)),t.roles.tree.alloced=e.data.alloced,t.roles.tree.unalloced=e.data.unalloced)})},showAllocDialog:function(e){this.roles.modal_dialog=!0,this.roles.formItem.pkUser=e.row.id,this.getlist(e.row.id)},add:function(){var e=this.$refs.unallocedtree.getSelectedNodes();if(console.log((0,l.default)(e)),0==e.length)return void console.log("未选中角色");if(console.log((0,l.default)(e[0].isLeaf)),e.length>0)if(e[0].isLeaf)this.nodeOperation(e,this.roles.tree.unalloced,this.roles.tree.alloced);else{console.log("is not leaf=====================>");for(var t=e[0],o=0;o<this.roles.tree.unalloced.length;o++){var a=this.roles.tree.unalloced[o];if(a.id==t.id){this.roles.tree.unalloced.splice(o,o+1);break}}this.roles.tree.alloced.push(t)}},remove:function(){var e=this.$refs.allocedtree.getSelectedNodes();if(console.log(e),e.length>0)if(e[0].isLeaf)console.log("is leaf=====================>"),this.nodeOperation(e,this.roles.tree.alloced,this.roles.tree.unalloced);else{for(var t=e[0],o=0;o<this.roles.tree.alloced.length;o++){var a=this.roles.tree.alloced[o];if(a.id==t.id){this.roles.tree.alloced.splice(o,o+1);break}}this.roles.tree.unalloced.push(t)}},nodeOperation:function(e,t,o){for(var a=void 0,r=e[0],l=0;l<t.length;l++)if(a=t[l],a.id==r.parent.id){if(1==a.children.length){t.splice(l,l+1);break}for(var s=0;s<a.children.length;s++)if(r.id==a.children[s].id){a.children.splice(s,s+1);break}}if(0==o.length){var i=void 0;r.parent?(i={id:r.parent.id,title:r.parent.title,isLeaf:!1,expand:!0,children:[]},i.children.push(r),o.push(i)):o.push(r)}else{var n=void 0,d=!1;for(n=0;n<o.length;n++){var m=o[n];if(r.parent&&r.parent.id==m.id){d=!0;break}}if(r.parent&&d)o[n].children.push(r);else if(r.parent&&!d){var u={id:r.parent.id,title:r.parent.title,isLeaf:!1,expand:!0,children:[]};u.children.push(r),o.push(u)}else o.push(r)}},save:function(){for(var e=this,t=[],o=0;o<this.roles.tree.alloced.length;o++){var a=this.roles.tree.alloced[o].children;if(a)for(var r=0;r<a.length;r++)a[r]&&t.push(a[r].id)}console.log("pkRoles==========>"+t.toString()),this.api.admin.userrole.save({pkUser:this.roles.formItem.pkUser,pkRoles:t.toString()}).then(function(t){t.result?e.$Message.info("操作成功"):(console.log(t.msg),e.$Message.error("操作失败"))})},unsave:function(){}}}},2030:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("Row",[o("i-col",[o("Form",{ref:"formQuery",staticClass:"query_area",attrs:{model:e.formQuery,inline:""}},[o("Form-item",{attrs:{prop:"bsCode"}},[o("Input",{attrs:{placeholder:"帐号"},model:{value:e.formQuery.bsCode,callback:function(t){e.$set(e.formQuery,"bsCode",t)},expression:"formQuery.bsCode"}})],1),e._v(" "),o("Form-item",{attrs:{prop:"bsName"}},[o("Input",{attrs:{placeholder:"姓名"},model:{value:e.formQuery.bsName,callback:function(t){e.$set(e.formQuery,"bsName",t)},expression:"formQuery.bsName"}})],1),e._v(" "),e.menuData.perms.QUERY?o("Form-item",[o("Button",{attrs:{type:"primary"},on:{click:function(t){e.handleSubmit("formQuery")}}},[e._v("查 询")])],1):e._e(),e._v(" "),e.menuData.perms.ADD?o("Form-item",[o("Button",{attrs:{type:"primary"},on:{click:function(t){e.showAddDialog()}}},[e._v("新 增")])],1):e._e()],1)],1)],1),e._v(" "),o("Row",[o("i-col",{attrs:{span:"24"}},[o("Table",{attrs:{data:e.datagrid.data.rows,columns:e.datagrid.columns,stripe:"",height:"500"}}),e._v(" "),o("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[o("div",{staticStyle:{float:"right"}},[o("Page",{attrs:{total:e.datagrid.data.total,current:1,"page-size":e.datagrid.queryParams.rows,"page-size-opts":e.datagrid.pagination,"show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage}})],1)])],1)],1),e._v(" "),o("Modal",{attrs:{title:"",width:"800"},on:{"on-ok":e.ok,"on-cancel":e.cancel},model:{value:e.dialog.modal_dialog,callback:function(t){e.$set(e.dialog,"modal_dialog",t)},expression:"dialog.modal_dialog"}},[o("p",[o("Form",{ref:e.dialog.ruleForm,attrs:{model:e.dialog.formItem,rules:e.dialog.ruleForm,"label-width":80}},[o("span",{staticStyle:{display:"none"}},[o("Input",{model:{value:e.dialog.formItem.id,callback:function(t){e.$set(e.dialog.formItem,"id",t)},expression:"dialog.formItem.id"}})],1),e._v(" "),o("Row",[o("i-col",{attrs:{span:"12"}},[o("Form-item",{attrs:{label:"集团",prop:"pkGroup"}},[o("Select",{attrs:{placeholder:"请输入"},on:{"on-change":e.getOrgList},model:{value:e.dialog.formItem.pkGroup,callback:function(t){e.$set(e.dialog.formItem,"pkGroup",t)},expression:"dialog.formItem.pkGroup"}},e._l(e.groups,function(t){return o("Option",{key:t.bsCode,attrs:{value:t.id}},[e._v(e._s(t.bsName))])}))],1)],1),e._v(" "),o("i-col",{attrs:{span:"12"}},[o("Form-item",{attrs:{label:"组织",prop:"pkOrg"}},[o("Select",{attrs:{placeholder:"请输入"},model:{value:e.dialog.formItem.pkOrg,callback:function(t){e.$set(e.dialog.formItem,"pkOrg",t)},expression:"dialog.formItem.pkOrg"}},[o("Option",{attrs:{value:"1"}},[e._v("全局")]),e._v(" "),e._l(e.orgs,function(t){return o("Option",{key:t.bsCode,attrs:{value:t.id}},[e._v(e._s(t.bsName))])})],2)],1)],1)],1),e._v(" "),o("Row",[o("i-col",{attrs:{span:"12"}},[o("Form-item",{attrs:{label:"帐号",prop:"bsCode"}},[o("Input",{attrs:{placeholder:"请输入"},model:{value:e.dialog.formItem.bsCode,callback:function(t){e.$set(e.dialog.formItem,"bsCode",t)},expression:"dialog.formItem.bsCode"}})],1)],1),e._v(" "),o("i-col",{attrs:{span:"12"}},[o("Form-item",{attrs:{label:"姓名",prop:"bsName"}},[o("Input",{attrs:{placeholder:"请输入"},model:{value:e.dialog.formItem.bsName,callback:function(t){e.$set(e.dialog.formItem,"bsName",t)},expression:"dialog.formItem.bsName"}})],1)],1)],1),e._v(" "),o("Row",[o("i-col",{attrs:{span:"12"}},[o("Form-item",{attrs:{label:"手机号",prop:"bsMobile"}},[o("Input",{attrs:{placeholder:"请输入"},model:{value:e.dialog.formItem.bsMobile,callback:function(t){e.$set(e.dialog.formItem,"bsMobile",t)},expression:"dialog.formItem.bsMobile"}})],1)],1),e._v(" "),o("i-col",{attrs:{span:"12"}},[o("Form-item",{attrs:{label:"邮箱地址",prop:"bsEmail"}},[o("Input",{attrs:{placeholder:"请输入"},model:{value:e.dialog.formItem.bsEmail,callback:function(t){e.$set(e.dialog.formItem,"bsEmail",t)},expression:"dialog.formItem.bsEmail"}})],1)],1)],1),e._v(" "),o("Row",[o("i-col",{attrs:{span:"24"}},[o("Form-item",{attrs:{label:"备注"}},[o("Input",{attrs:{type:"textarea",placeholder:"请输入..."},model:{value:e.dialog.formItem.bsComment,callback:function(t){e.$set(e.dialog.formItem,"bsComment",t)},expression:"dialog.formItem.bsComment"}})],1)],1)],1)],1)],1)]),e._v(" "),o("Modal",{attrs:{title:"分配角色"},on:{"on-ok":e.save,"on-cancel":e.unsave},model:{value:e.roles.modal_dialog,callback:function(t){e.$set(e.roles,"modal_dialog",t)},expression:"roles.modal_dialog"}},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.roles.formItem.pkUser,expression:"roles.formItem.pkUser"}],attrs:{type:"hidden",name:"pkUser",value:""},domProps:{value:e.roles.formItem.pkUser},on:{input:function(t){t.target.composing||e.$set(e.roles.formItem,"pkUser",t.target.value)}}}),e._v(" "),o("Row",[o("i-col",{attrs:{span:"10"}},[e._v("\n                已分配角色\n            ")]),e._v(" "),o("i-col",{attrs:{span:"4"}}),e._v(" "),o("i-col",{attrs:{span:"10"}},[e._v("\n                未分配角色\n            ")])],1),e._v(" "),o("Row",[o("i-col",{attrs:{span:"10"}},[o("Tree",{ref:"allocedtree",staticClass:"layout-menu-left",staticStyle:{height:"500px"},attrs:{data:e.roles.tree.alloced}})],1),e._v(" "),o("i-col",{attrs:{span:"4"}},[o("Button",{attrs:{type:"primary"},on:{click:function(t){e.add()}}},[e._v("添 加")]),e._v(" "),o("Button",{attrs:{type:"primary"},on:{click:function(t){e.remove()}}},[e._v("移 除")])],1),e._v(" "),o("i-col",{attrs:{span:"10"}},[o("Tree",{ref:"unallocedtree",staticClass:"layout-menu-left",staticStyle:{height:"500px"},attrs:{data:e.roles.tree.unalloced}})],1)],1)],1)],1)},r=[];a._withStripped=!0;var l={render:a,staticRenderFns:r};t.default=l}});