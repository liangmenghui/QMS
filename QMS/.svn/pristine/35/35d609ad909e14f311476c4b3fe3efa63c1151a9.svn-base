webpackJsonp([18],{1044:function(t,e,a){"use strict";function s(t){p||a(1843)}Object.defineProperty(e,"__esModule",{value:!0});var o=a(1622),l=a.n(o);for(var n in o)"default"!==n&&function(t){a.d(e,t,function(){return o[t]})}(n);var i=a(1845),r=a.n(i),p=!1,d=a(1),c=s,u=d(l.a,r.a,!1,c,null,null);u.options.__file="src\\view\\approved\\ProductQualityApproved.vue",e.default=u.exports},1110:function(t,e,a){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=a(15),l=s(o),n=a(23),i=s(n);e.default={props:["approvedItemRecord","type","data","needCoach"],data:function(){return{showFailedModel:!1,showSuccessModel:!1,showRejectModel:!1,isCoach:1,resultDesc:"",flowDesc:""}},created:function(){},methods:{showModel:function(t){3==t?this.showFailedModel=!0:2==t?this.showRejectModel=!0:this.showSuccessModel=!0},approved:function(t){var e=this;if(0!=t){var a={bsItemsId:this.approvedItemRecord.itemsBy.id,bsItemsRecordId:this.approvedItemRecord.id,bsResult:t,itemsDesc:this.flowDesc,resultDesc:this.resultDesc};this.needCoach&&(a.isCoach=this.isCoach),this.api.Audit.approved(a).then(function(a){e.$Message.info("提交审核结果完成"),e.bsStatus=t;var s=e.$route.matched[e.$route.matched.length-2].path,o={path:s,query:{bsFlowRecordId:e.$route.query.bsFlowRecordId}};e.$router.replace(o)})}},saveRecord:function(t){var e=this;if("audits"==this.type){for(var a=new Array,s=this.data,o=0;o<s.length;o++){var n={};n.bsItemsRecoreId=this.approvedItemRecord.id,n.bsTermsId=s[o].ID,n.bsScore=s[o].BS_SCORE,n.bsDesc=s[o].BS_DESC,void 0!=s[o].SCORE_ID&&(n.id=s[o].SCORE_ID),a.push(n)}(0,i.default)(a);this.api.Audit.records({approvedTermsScoreStr:(0,i.default)(a)}).then(function(a){e.$emit("updateTermsRecord"),e.$Message.info("保存成功"),e.approved(t)})}else if("inspect"==this.type){var r=(0,l.default)({},this.data);r=this.$Util.formattedParams(r),this.api.shipmentInspect.edit(r).then(function(a){e.$Message.info("保存成功"),e.approved(t)})}else if("quality"==this.type){var r=(0,l.default)({},this.data);r=this.$Util.formattedParams(r),this.api.qualityInspect.edit(r).then(function(a){e.$Message.info("保存成功"),e.approved(t)})}else this.approved(t)}}}},1111:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["approvedData"],data:function(){return{}}}},1152:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(1110),o=a.n(s);for(var l in s)"default"!==l&&function(t){a.d(e,t,function(){return s[t]})}(l);var n=a(1153),i=a.n(n),r=a(1),p=r(o.a,i.a,!1,null,null,null);p.options.__file="src\\components\\ApprovedAction.vue",e.default=p.exports},1153:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"component"},[a("center",[a("el-button",{staticStyle:{padding:"7px 20px"},attrs:{type:"primary"},on:{click:function(e){t.saveRecord(0)}}},[a("i",{staticClass:"el-icon-news"}),t._v("  "+t._s(t.$t("Button.SaveChanges"))+"\n        ")]),t._v(" "),t.approvedItemRecord.bsStep>1?a("el-button",{staticStyle:{padding:"7px 20px","margin-left":"3%"},attrs:{type:"danger"},on:{click:function(e){t.showModel(2)}}},[a("i",{staticClass:"el-icon-close"}),t._v("  "+t._s(t.$t("Button.DismissReview"))+"\n        ")]):t._e(),t._v(" "),a("el-button",{staticStyle:{padding:"7px 20px","margin-left":"3%"},attrs:{type:"danger"},on:{click:function(e){t.showModel(3)}}},[a("i",{staticClass:"el-icon-close"}),t._v("  "+t._s(t.$t("Button.AuditFailed"))+"\n        ")]),t._v(" "),a("el-button",{staticStyle:{padding:"7px 20px","margin-left":"3%"},attrs:{type:"success"},on:{click:function(e){t.showModel(1)}}},[a("i",{staticClass:"el-icon-check"}),t._v("  "+t._s(t.$t("Button.Approved"))+"\n        ")]),t._v(" "),a("Modal",{on:{"on-ok":function(e){t.saveRecord(3)}},model:{value:t.showFailedModel,callback:function(e){t.showFailedModel=e},expression:"showFailedModel"}},[a("el-form",{attrs:{"label-width":"80"}},[a("p",{staticStyle:{"font-size":"16px",color:"#F56C6C"}},[t._v("确认当前审核失败？")]),t._v(" "),void 0!=t.flowDesc&&t.flowDesc.length>0?a("el-form-item",{attrs:{label:"结果说明"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.flowDesc,callback:function(e){t.flowDesc=e},expression:"flowDesc"}})],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"审核意见",prop:""}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.resultDesc,callback:function(e){t.resultDesc=e},expression:"resultDesc"}})],1)],1)],1),t._v(" "),a("Modal",{on:{"on-ok":function(e){t.saveRecord(1)}},model:{value:t.showSuccessModel,callback:function(e){t.showSuccessModel=e},expression:"showSuccessModel"}},[a("el-form",{attrs:{"label-width":"80"}},[a("p",{staticStyle:{"font-size":"16px",color:"#67C23A"}},[t._v("确认当前审核通过？")]),t._v(" "),a("el-form-item",{attrs:{label:"结果说明",prop:""}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.flowDesc,callback:function(e){t.flowDesc=e},expression:"flowDesc"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"审核意见",prop:""}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.resultDesc,callback:function(e){t.resultDesc=e},expression:"resultDesc"}})],1),t._v(" "),t.needCoach?a("el-form-item",{attrs:{label:t.$t("supplier.coach")}},[a("el-select",{model:{value:t.isCoach,callback:function(e){t.isCoach=e},expression:"isCoach"}},[a("el-option",{attrs:{label:"是",value:1}}),t._v(" "),a("el-option",{attrs:{label:"否",value:2}})],1)],1):t._e()],1)],1),t._v(" "),a("Modal",{on:{"on-ok":function(e){t.saveRecord(2)}},model:{value:t.showRejectModel,callback:function(e){t.showRejectModel=e},expression:"showRejectModel"}},[a("el-form",{attrs:{"label-width":"80"}},[a("p",{staticStyle:{"font-size":"16px",color:"#67C23A"}},[t._v("驳回当前审核？")]),t._v(" "),a("el-form-item",{attrs:{label:"结果说明",prop:""}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.flowDesc,callback:function(e){t.flowDesc=e},expression:"flowDesc"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"审核意见",prop:""}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.resultDesc,callback:function(e){t.resultDesc=e},expression:"resultDesc"}})],1)],1)],1)],1)],1)},o=[];s._withStripped=!0;var l={render:s,staticRenderFns:o};e.default=l},1154:function(t,e,a){"use strict";function s(t){p||a(1155)}Object.defineProperty(e,"__esModule",{value:!0});var o=a(1111),l=a.n(o);for(var n in o)"default"!==n&&function(t){a.d(e,t,function(){return o[t]})}(n);var i=a(1157),r=a.n(i),p=!1,d=a(1),c=s,u=d(l.a,r.a,!1,c,null,null);u.options.__file="src\\components\\approvedResultRecord.vue",e.default=u.exports},1155:function(t,e,a){var s=a(1156);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);a(28)("45c6c753",s,!1,{})},1156:function(t,e,a){e=t.exports=a(27)(!1),e.push([t.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},1157:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"margin-top":"60px"}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("审核状态: "+t._s(t.$t("approved.status["+t.approvedData.bsStatus+"]")))]),t._v(" "),a("p",{attrs:{slot:"title"},slot:"title"},[t._v("结果说明: "+t._s(t.approvedData.bsDesc))]),t._v(" "),t.approvedData.resultSet.length>0?a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.approvedData.resultSet}},[a("el-table-column",{attrs:{label:"审核结果"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t.$t("product.bsResult["+(e.row.bsResult-1)+"]")))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"resultBy.bsName",label:"负责人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"bsDesc",label:"审核意见"}}),t._v(" "),a("el-table-column",{attrs:{prop:"bsCreatedTime",label:"时间"}})],1)],1):t._e()])],1)},o=[];s._withStripped=!0;var l={render:s,staticRenderFns:o};e.default=l},1622:function(t,e,a){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=a(23),l=s(o),n=a(24),i=s(n),r=a(1152),p=s(r),d=a(1154),c=s(d);e.default={components:{ApprovedAction:p.default,approvedResultRecord:c.default},data:function(){return{showSampleInfoSelectorModal:!1,showSampleRegularInputerModal:!1,sampleInfoRows:[],sampleRegularRows:[],sampleRegularRecordData:[],qualityInspectData:{},productInfo:{},sampleInfo:{},approvedItemRecord:{},perms:{}}},created:function(){this.getSampleInfoData(),this.getInspectData(),this.productInfo=this.$store.getters.getProductData,this.getSampleRegularData({bsSampleId:this.sampleInfo.id}),this.approvedItemRecord=this.$store.getters.getItemRecordData,this.perms.edit=(this.approvedItemRecord.users.includes(i.default.get("user"))||this.Util.hasPerm("EDIT"))&&1==this.approvedItemRecord.bsStatus},methods:{getInspectData:function(){var t=this,e={bsPrId:this.$store.getters.getProductData.id,bsFlowRecordId:this.$route.query.bsFlowRecordId};this.api.qualityInspect.getlist(e).then(function(e){e.data.rows.length?(t.qualityInspectData=e.data.rows[0],void 0!=t.qualityInspectData.bsSampleId&&(t.getSampleRegularData({bsSampleId:t.qualityInspectData.bsSampleId}),t.getSampleInfoDataById({id:t.qualityInspectData.bsSampleId})),t.getSampleRecordsData()):t.addInspect()})},getSampleInfoData:function(){var t=this;this.api.sampleinfo.getlist().then(function(e){t.sampleInfoRows=e.data.rows})},getSampleInfoDataById:function(t){var e=this;this.api.sampleinfo.getlist(t).then(function(t){e.sampleInfo=t.data.rows[0]})},getSampleRegularData:function(t){var e=this;this.api.sampleRegular.getlist(t).then(function(t){e.sampleRegularRows=t.data.rows.map(function(t){return t})})},getSampleRecordsData:function(){var t=this;this.api.sampleinfo.getrecords({bsQualityId:this.qualityInspectData.id}).then(function(e){t.sampleRegularRecordData=e.data.rows.reverse().map(function(t){return t.recordSet})})},addSampleRegularData:function(){this.sampleRegularRows=this.sampleRegularRows.map(function(t){return{bsMeasureResult:"",bsRemark:"",bsName:t.bsName,bsTool:t.bsTool,bsUnit:t.bsUnit,bsSampleRegularId:t.id}}),this.showSampleRegularInputerModal=!0},sampleRegularInputerOK:function(){var t=this,e=this.sampleRegularRows.map(function(t){var e={bsMeasureResult:t.bsMeasureResult,bsRemark:t.bsRemark,bsSampleRegularId:t.bsSampleRegularId};return t.id&&(e.id=t.id),e}),a={};a.bsSampleId=this.sampleInfo.id,a.bsQualityId=this.qualityInspectData.id,a.sampleRegularRecordStr=(0,l.default)(e),this.api.sampleRegular.addRecord(a).then(function(e){t.sampleRegularRecordData.push(e.data)})},sampleRegularInputerCancel:function(){},addInspect:function(){var t=this,e={bsPrId:this.$store.getters.getProductData.id,bsFlowRecordId:this.$route.query.bsFlowRecordId};this.api.qualityInspect.add(e).then(function(e){t.qualityInspectData=e.data})},downloadFile:function(){var t={fsFileId:this.approvedItemRecord.fileSet[0].fsFileId};this.api.fileQms.getfile(t).then(function(t){t.click()})}}}},1843:function(t,e,a){var s=a(1844);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);a(28)("20419849",s,!1,{})},1844:function(t,e,a){e=t.exports=a(27)(!1),e.push([t.i,"\n.productqualityapproved #top2{\n\tbackground-color: white;padding-top: 30px;padding-bottom: 50px;padding-left: 5%;\n}\n.productqualityapproved .top2-div{\n\theight: 50px;\n}\n.productqualityapproved .top2-text{\n\tfloat: left;margin-top: 10px;width: 130px;font-size: 14px;\n}\n.productqualityapproved .top2-input{\n\tfloat: left;\n}\n.productqualityapproved .top2-input .el-input{\n\twidth: 250px;\n}\n.productqualityapproved #sampletable{\n\tbackground-color: white;padding-top: 20px;padding-bottom: 100px;\n\tpadding-left: 5%;padding-right: 5%;\n}\n.productqualityapproved hr{\n\twidth:100%;border: none;height: 1px;background-color: #BBD7E7;margin-top: 20px;margin-bottom: 20px;\n}\n.productqualityapproved #bottom{\n\theight:150px;margin-top: 20px;margin-bottom: 20px;background-color: white;\n\tpadding-top: 50px;padding-left: 5%;\n}\n",""])},1845:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"productqualityapproved"},[a("Row",{style:{marginBottom:"20px"}},[a("center",[a("h4",{staticStyle:{"font-size":"16px"}},[t._v("产品质量审核报告")])])],1),t._v(" "),a("Row",{style:{marginBottom:"20px"}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{staticStyle:{color:"#ff9900"},attrs:{type:"cube"}}),t._v("\n                     "+t._s(t.$t("approved.ProductInformation"))+"\n               \t")],1),t._v(" "),t.perms.edit?t._e():a("el-tag",{staticStyle:{"font-size":"14px"},attrs:{slot:"extra",color:"white"},slot:"extra"},[t._v("\n\t\t\t\t\t"+t._s(t.$t("approved.statusLabel"))+": "+t._s(t.$t("approved.status["+t.approvedItemRecord.bsStatus+"]"))+"\n\t\t\t\t")]),t._v(" "),a("div",{attrs:{id:"top2"}},[a("div",{staticClass:"top2-div"},[a("div",{staticClass:"top2-text"},[t._v(t._s(t.$t("product.name"))+"：")]),t._v(" "),a("div",{staticClass:"top2-input"},[a("el-input",{attrs:{readonly:""},model:{value:t.productInfo.bsPrName,callback:function(e){t.$set(t.productInfo,"bsPrName",e)},expression:"productInfo.bsPrName"}})],1)]),t._v(" "),a("div",{staticClass:"top2-div"},[a("div",{staticClass:"top2-text"},[t._v(t._s(t.$t("product.code"))+"：")]),t._v(" "),a("div",{staticClass:"top2-input"},[a("el-input",{attrs:{readonly:""},model:{value:t.productInfo.bsPrCode,callback:function(e){t.$set(t.productInfo,"bsPrCode",e)},expression:"productInfo.bsPrCode"}},[t._v(t._s(t.productInfo.bsPrCode))])],1)]),t._v(" "),a("div",{staticClass:"top2-div"},[a("div",{staticClass:"top2-text"},[t._v(t._s(t.$t("approved.SamplingDate"))+"：")]),t._v(" "),a("div",{staticClass:"top2-input"},[a("el-input",{model:{value:t.qualityInspectData.bsSamplingDate,callback:function(e){t.$set(t.qualityInspectData,"bsSamplingDate",e)},expression:"qualityInspectData.bsSamplingDate"}})],1)]),t._v(" "),a("div",{staticClass:"top2-div"},[a("div",{staticClass:"top2-text"},[t._v(t._s(t.$t("approved.SamplingLocations"))+"：")]),t._v(" "),a("div",{staticClass:"top2-input"},[a("el-input",{model:{value:t.qualityInspectData.bsSamplingPlace,callback:function(e){t.$set(t.qualityInspectData,"bsSamplingPlace",e)},expression:"qualityInspectData.bsSamplingPlace"}})],1)]),t._v(" "),a("div",{staticClass:"top2-div"},[a("div",{staticClass:"top2-text"},[t._v(t._s(t.$t("approved.DateInProduced"))+"：")]),t._v(" "),a("div",{staticClass:"top2-input"},[a("el-input",{model:{value:t.qualityInspectData.bsProductDate,callback:function(e){t.$set(t.qualityInspectData,"bsProductDate",e)},expression:"qualityInspectData.bsProductDate"}})],1)])])],1)],1),t._v(" "),a("Row",{style:{marginBottom:"20px"}},[a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{staticStyle:{color:"#ff9900"},attrs:{type:"ios-browsers"}}),t._v("\n                     "+t._s(t.$t("approved.SampleInformation"))+"\n               \t")],1),t._v(" "),a("div",{staticStyle:{"margin-top":"-9px"},attrs:{slot:"extra"},slot:"extra"},[a("p",{staticStyle:{display:"inline-block"}},[t._v(t._s(t.$t("sample.Set"))+"：")]),t._v(" "),a("el-form",{ref:t.sampleInfo,staticStyle:{display:"inline-block"},attrs:{model:t.sampleInfo,"label-width":"80"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{"value-key":"id"},model:{value:t.sampleInfo,callback:function(e){t.sampleInfo=e},expression:"sampleInfo"}},t._l(t.sampleInfoRows,function(t){return a("el-option",{key:t.id,attrs:{label:t.bsName,value:t}})}))],1),t._v(" "),a("el-button",{staticStyle:{display:"inline-block",padding:"10px 20px","margin-top":"2px"},attrs:{type:"primary",disabled:void 0==t.sampleInfo.bsName},on:{click:function(e){t.addSampleRegularData()}}},[a("i",{staticClass:"el-icon-plus"}),t._v("  "+t._s(t.$t("approved.AddSample"))+"\n\t\t\t\t\t")])],1),t._v(" "),void 0!=t.sampleRegularRows?a("div",{attrs:{id:"sampletable"}},[[a("Row",{attrs:{type:"flex"}},[a("Col",{attrs:{span:"2"}}),t._v(" "),a("Col",{attrs:{span:"20"}},t._l(t.sampleRegularRows,function(e){return a("Col",{key:e.id,staticStyle:{"font-size":"14px"},attrs:{span:"2"}},[t._v(t._s(e.bsName))])})),t._v(" "),a("Col",{staticStyle:{"font-size":"14px"},attrs:{span:"2"}},[t._v(t._s(t.$t("Button.operating")))]),t._v(" "),a("hr")],1),t._v(" "),t._l(t.sampleRegularRecordData,function(e){return a("Row",{key:e.id,attrs:{type:"flex"}},[a("Col",{staticStyle:{"font-size":"14px"},attrs:{span:"2"}},[t._v("样品"+t._s(t.sampleRegularRecordData.indexOf(e)+1))]),t._v(" "),a("Col",{attrs:{span:"20"}},t._l(e,function(e){return a("Col",{key:e.id,attrs:{span:"2"}},[t._v(t._s(e.bsMeasureResult))])})),t._v(" "),a("Col",{staticStyle:{"font-size":"14px"},attrs:{span:"1"}},[a("el-button",{staticStyle:{padding:"3px 0px"},attrs:{type:"text"}},[t._v(t._s(t.$t("Button.Edit")))])],1),t._v(" "),a("Col",{staticStyle:{"font-size":"14px"},attrs:{span:"1"}},[a("el-button",{staticStyle:{padding:"3px 0px"},attrs:{type:"text"}},[t._v(t._s(t.$t("Button.Delete")))])],1),t._v(" "),a("hr")],1)})]],2):t._e()])],1),t._v(" "),a("approvedResultRecord",{attrs:{approvedData:t.approvedItemRecord}}),t._v(" "),t.perms.edit?a("div",{attrs:{id:"bottom"}},[a("ApprovedAction",{attrs:{type:"quality",data:t.qualityInspectData,approvedItemRecord:t.approvedItemRecord}})],1):t._e(),t._v(" "),a("Modal",{attrs:{title:t.sampleInfo.bsName,width:"500"},on:{"on-ok":t.sampleRegularInputerOK,"on-cancel":t.sampleRegularInputerCancel},model:{value:t.showSampleRegularInputerModal,callback:function(e){t.showSampleRegularInputerModal=e},expression:"showSampleRegularInputerModal"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.sampleRegularRows}},[a("el-table-column",{attrs:{label:t.$t("approved.specification"),prop:"bsName",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("approved.tool"),prop:"bsTool",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("sample.Unit"),prop:"bsUnit",width:"60"}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("approved.MeasuredValue"),prop:"bsMeasureResult",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{staticStyle:{width:"80px"},model:{value:e.row.bsMeasureResult,callback:function(a){t.$set(e.row,"bsMeasureResult",a)},expression:"scope.row.bsMeasureResult"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("approved.Result"),prop:"bsRemark",width:"130"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{staticStyle:{width:"100px"},model:{value:e.row.bsRemark,callback:function(a){t.$set(e.row,"bsRemark",a)},expression:"scope.row.bsRemark"}},[a("el-option",{attrs:{label:t.$t("approved.qualified"),value:1}}),t._v(" "),a("el-option",{attrs:{label:t.$t("approved.unqualified"),value:2}})],1)]}}])})],1)],1)],1)},o=[];s._withStripped=!0;var l={render:s,staticRenderFns:o};e.default=l}});