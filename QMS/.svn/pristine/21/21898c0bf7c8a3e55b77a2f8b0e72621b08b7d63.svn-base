webpackJsonp([2],{1292:function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(16),r=a(s),l=o(30),i=a(l);t.default={props:["approvedItemRecord","type","data","sampleRegularRecords"],data:function(){return{showFailedModel:!1,showSuccessModel:!1,showRejectModel:!1,isCoach:1,resultDesc:"",flowDesc:""}},created:function(){},mounted:function(){},methods:{showModel:function(e){3==e?this.showFailedModel=!0:2==e?this.showRejectModel=!0:this.showSuccessModel=!0},approved:function(e){var t=this;if(0!=e){var o={bsItemsId:this.approvedItemRecord.itemsBy.id,bsItemsRecordId:this.approvedItemRecord.id,bsResult:e,itemsDesc:this.flowDesc,resultDesc:this.resultDesc};this.api.Audit.approved(o).then(function(o){t.$Message.info("提交审核结果完成"),t.bsStatus=e;var a=t.$route.matched[t.$route.matched.length-2].path,s={path:a,query:{bsFlowRecordId:t.$route.query.bsFlowRecordId,refresh:!0}};t.$router.replace(s)})}},saveRecord:function(e){var t=this;if("audits"==this.type){for(var o=new Array,a=this.data,s=0;s<a.length;s++){var l={};l.bsItemsRecoreId=this.approvedItemRecord.id,l.bsTermsId=a[s].ID,l.bsScore=a[s].BS_SCORE,l.bsDesc=a[s].BS_DESC,void 0!=a[s].SCORE_ID&&(l.id=a[s].SCORE_ID),o.push(l)}(0,i.default)(o);this.api.Audit.records({approvedTermsScoreStr:(0,i.default)(o)}).then(function(o){t.$emit("updateTermsRecord"),t.$Message.info("保存成功"),t.approved(e)})}else if("inspect"==this.type){var n=(0,r.default)({},this.data);if(n=this.$Util.formattedParams(n),this.api.shipmentInspect.edit(n).then(function(o){t.$Message.info("保存成功"),t.approved(e)}),void 0!=this.sampleRegularRecords){for(var n={bsShipmentInspectId:n.id},d=[],s=0;s<this.sampleRegularRecords.length;s++)for(var c=this.sampleRegularRecords[s],p=0;p<c.records.length;p++){var u=c.records[p];d.push(this.$Util.formattedParams(u))}n.sampleRegularRecordStr=(0,i.default)(d),this.api.sampleRegularRecord.add(n).then(function(e){t.$emit("saved")})}}else if("quality"==this.type){var n=(0,r.default)({},this.data);n=this.$Util.formattedParams(n),this.api.qualityInspect.edit(n).then(function(o){t.$Message.info("保存成功"),t.approved(e)})}else this.approved(e)}}}},1293:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={props:["approvedData","isCoach"],data:function(){return{}}}},1317:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(1292),s=o.n(a);for(var r in a)"default"!==r&&function(e){o.d(t,e,function(){return a[e]})}(r);var l=o(1318),i=o.n(l),n=o(1),d=n(s.a,i.a,!1,null,null,null);d.options.__file="src/views/qms/components/approvedAction.vue",t.default=d.exports},1318:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"component"},[o("center",[o("el-button",{staticStyle:{padding:"7px 20px"},attrs:{type:"primary"},on:{click:function(t){e.saveRecord(0)}}},[o("i",{staticClass:"el-icon-news"}),e._v("  "+e._s(e.$t("Button.SaveChanges"))+"\n        ")]),e._v(" "),e.approvedItemRecord.bsStatus>0&&e.approvedItemRecord.bsStep>1?o("el-button",{staticStyle:{padding:"7px 20px","margin-left":"3%"},attrs:{type:"warning"},on:{click:function(t){e.showModel(2)}}},[o("i",{staticClass:"el-icon-warning"}),e._v("  "+e._s(e.$t("Button.DismissReview"))+"\n        ")]):e._e(),e._v(" "),e.approvedItemRecord.bsStatus>0?o("el-button",{staticStyle:{padding:"7px 20px","margin-left":"3%"},attrs:{type:"danger"},on:{click:function(t){e.showModel(3)}}},[o("i",{staticClass:"el-icon-close"}),e._v("  "+e._s(e.$t("Button.AuditFailed"))+"\n        ")]):e._e(),e._v(" "),e.approvedItemRecord.bsStatus>0?o("el-button",{staticStyle:{padding:"7px 20px","margin-left":"3%"},attrs:{type:"success"},on:{click:function(t){e.showModel(1)}}},[o("i",{staticClass:"el-icon-check"}),e._v("  "+e._s(e.$t("Button.Approved"))+"\n        ")]):e._e(),e._v(" "),o("Modal",{on:{"on-ok":function(t){e.saveRecord(3)}},model:{value:e.showFailedModel,callback:function(t){e.showFailedModel=t},expression:"showFailedModel"}},[o("el-form",{attrs:{"label-width":"80"}},[o("p",{staticStyle:{"font-size":"16px",color:"#F56C6C"}},[e._v(e._s(e.$t("approved.failed_approved")))]),e._v(" "),o("el-form-item",{attrs:{label:e.$t("approved.result_comment")}},[o("el-input",{attrs:{type:"textarea"},model:{value:e.flowDesc,callback:function(t){e.flowDesc=t},expression:"flowDesc"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("approved.item_comment")}},[o("el-input",{attrs:{type:"textarea"},model:{value:e.resultDesc,callback:function(t){e.resultDesc=t},expression:"resultDesc"}})],1)],1)],1),e._v(" "),o("Modal",{on:{"on-ok":function(t){e.saveRecord(1)}},model:{value:e.showSuccessModel,callback:function(t){e.showSuccessModel=t},expression:"showSuccessModel"}},[o("el-form",{attrs:{"label-width":"80"}},[o("p",{staticStyle:{"font-size":"16px",color:"#67C23A"}},[e._v(e._s(e.$t("approved.comfirm_approved")))]),e._v(" "),o("el-form-item",{attrs:{label:e.$t("approved.result_comment")}},[o("el-input",{attrs:{type:"textarea"},model:{value:e.flowDesc,callback:function(t){e.flowDesc=t},expression:"flowDesc"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("approved.item_comment")}},[o("el-input",{attrs:{type:"textarea"},model:{value:e.resultDesc,callback:function(t){e.resultDesc=t},expression:"resultDesc"}})],1)],1)],1),e._v(" "),o("Modal",{on:{"on-ok":function(t){e.saveRecord(2)}},model:{value:e.showRejectModel,callback:function(t){e.showRejectModel=t},expression:"showRejectModel"}},[o("el-form",{attrs:{"label-width":"80"}},[o("p",{staticStyle:{"font-size":"16px",color:"#F56C6C"}},[e._v(e._s(e.$t("approved.reject_approved")))]),e._v(" "),o("el-form-item",{attrs:{label:e.$t("approved.result_comment")}},[o("el-input",{attrs:{type:"textarea"},model:{value:e.flowDesc,callback:function(t){e.flowDesc=t},expression:"flowDesc"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("approved.item_comment")}},[o("el-input",{attrs:{type:"textarea"},model:{value:e.resultDesc,callback:function(t){e.resultDesc=t},expression:"resultDesc"}})],1)],1)],1)],1)],1)},s=[];a._withStripped=!0;var r={render:a,staticRenderFns:s};t.default=r},1319:function(e,t,o){"use strict";function a(e){d||o(1320)}Object.defineProperty(t,"__esModule",{value:!0});var s=o(1293),r=o.n(s);for(var l in s)"default"!==l&&function(e){o.d(t,e,function(){return s[e]})}(l);var i=o(1322),n=o.n(i),d=!1,c=o(1),p=a,u=c(r.a,n.a,!1,p,null,null);u.options.__file="src/views/qms/components/approvedResultRecord.vue",t.default=u.exports},1320:function(e,t,o){var a=o(1321);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(29)("510cd950",a,!1)},1321:function(e,t,o){t=e.exports=o(28)(!1),t.push([e.i,"\n.component{margin-top: 30px;\n}\n",""])},1322:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"component"},[o("Card",[o("p",{staticStyle:{display:"inline"},attrs:{slot:"title"},slot:"title"},[e._v("审核状态: "+e._s(e.$t("approved.status["+e.approvedData.bsStatus+"]")))]),e._v(" "),o("p",{staticStyle:{display:"inline","margin-left":"30px"},attrs:{slot:"title"},slot:"title"},[e._v("结果说明: "+e._s(e.approvedData.bsDesc))]),e._v(" "),e.approvedData.resultSet.length>0?o("div",[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.approvedData.resultSet}},[o("el-table-column",{attrs:{label:"审核结果"},scopedSlots:e._u([{key:"default",fn:function(t){return[void 0==e.isCoach?o("span",[e._v(e._s(e.$t("approved.itemResultDesc["+t.row.bsResult+"]")))]):e._e(),e._v(" "),void 0!=e.isCoach?o("span",[e._v(e._s(e.$t("approved.coachResultDesc["+t.row.bsResult+"]")))]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"resultBy.bsName",label:"负责人"}}),e._v(" "),o("el-table-column",{attrs:{prop:"bsDesc",label:"审核意见"}}),e._v(" "),o("el-table-column",{attrs:{prop:"bsCreatedTime",label:"时间"}})],1)],1):e._e()])],1)},s=[];a._withStripped=!0;var r={render:a,staticRenderFns:s};t.default=r},1395:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(16),s=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={props:["fileList","canUpload"],data:function(){return{dialogImageUrl:"",dialogVisible:!1,file:[]}},created:function(){this.fileList.map(function(e){return e.name=e.fsFileBy.bsName+e.fsFileBy.bsFileType,e})},methods:{handleRemove:function(e,t){var o=this;if(e.id&&canUpload){var a={id:e.id};this.api.approvedItemsRecordFile.delete(a).then(function(e){e.result?(o.fileList.remove(),o.$Message.info("删除成功")):o.$Message.error(e.msg)})}},handleUpload:function(e){return this.file=e,this.getData(),!0},getData:function(){var e=this,t=new FormData;t.append("file",this.file),t.append("bsItemsRecordId",this.$route.query.itemsRecordId),this.api.approvedItemsRecordFile.add(t).then(function(t){if(t.result){var o=(0,s.default)(t.data,{name:e.file.name});e.fileList.push(o)}else e.$Message.error(t.msg)})},downloadFile:function(e){var t={fsFileId:e.fsFileId};this.api.fileQms.getfile(t).then(function(e){e.click()})}}}},1688:function(e,t,o){"use strict";function a(e){d||o(1689)}Object.defineProperty(t,"__esModule",{value:!0});var s=o(1395),r=o.n(s);for(var l in s)"default"!==l&&function(e){o.d(t,e,function(){return s[e]})}(l);var i=o(1691),n=o.n(i),d=!1,c=o(1),p=a,u=c(r.a,n.a,!1,p,null,null);u.options.__file="src/views/qms/components/upload.vue",t.default=u.exports},1689:function(e,t,o){var a=o(1690);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(29)("3905d981",a,!1)},1690:function(e,t,o){t=e.exports=o(28)(!1),t.push([e.i,"\n.Uploadbox{margin-top:15px;\n}\n.el-upload--text {\n    background-color: #fff;\n    border: none;\n    border-radius: 6px;\n    box-sizing: border-box;\n  \n    text-align: center;\n    cursor: pointer;\n    position: relative;\n}\n.el-upload-list__item{width: 60%;\n}\n",""])},1691:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-upload",{staticClass:"upload-demo",attrs:{action:"","before-upload":e.handleUpload,"on-preview":e.downloadFile,"on-remove":e.handleRemove,"file-list":e.fileList}},[e.canUpload?o("el-button",{attrs:{size:"small",type:"success",plain:"",icon:"el-icon-plus"}},[e._v("\n    "+e._s(e.$t("upcoming.UploadAttachment"))+"\n  ")]):e._e(),e._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"})],1)],1)},s=[];a._withStripped=!0;var r={render:a,staticRenderFns:s};t.default=r},1797:function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(1688),r=a(s),l=o(1317),i=a(l),n=o(31),d=a(n),c=o(1319),p=a(c);t.default={data:function(){return{AuditFailedModal:!1,AuditFailedForm:{},ApprovedForm:{},audits:{},approvedItemData:{itemsRecordId:0,itemsId:0},terms:[],dialogImageUrl:"",dialogVisible:!1,approvedItemRecord:{},productInfo:{},supplierInfo:{},perms:{edit:!1},scoreOptions:[{label:"5",value:5},{label:"4",value:4},{label:"3",value:3},{label:"2",value:2},{label:"1",value:1},{label:"0",value:0},{label:"NA",value:-1}]}},created:function(){this.approvedItemRecord=this.$store.getters.getItemRecordData,this.approvedItemRecord.bsSuppId?this.supplierInfo=this.$store.getters.getSupplierData:this.productInfo=this.$store.getters.getProductData,void 0==this.approvedItemRecord.fileSet&&(this.approvedItemRecord.fileSet=[]),this.approvedItemData=this.$route.query,this.getData(),this.perms.edit=(this.approvedItemRecord.users.includes(d.default.get("user"))||this.$Util.hasPerm("VERIFY"))&&this.approvedItemRecord.bsStatus<2},beforeUpdate:function(){this.showRooterView=this.$route.matched.length>3},watch:{$route:function(e,t){this.showRooterView=e.matched.length>3}},components:{Upload:r.default,ApprovedAction:i.default,approvedResultRecord:p.default},methods:{getData:function(){var e=this;this.api.Audit.getlist(this.approvedItemData).then(function(t){e.terms=t.data})},updateTermsRecord:function(e){this.getData()}}}},2139:function(e,t,o){var a=o(2140);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(29)("3515d080",a,!1)},2140:function(e,t,o){t=e.exports=o(28)(!1),t.push([e.i,'\n.layout-content{padding:20px;background: #fff\n}\n.uploadtext{float: left;margin-right: 20px;font-size: 14px;\n}\n.uploadtxt .el-upload-dragger{border:none;\n}\n.fileList .el-upload-list__item {\n    margin-top: 10px;\n    margin-left: 65px;\n    padding: 10px;\n}\n.fltxt{float :left;display: inline-block;\n}\n.frtxt{float: right; text-align: right; margin-bottom: 10px;\n}\n.el-table .cell{font-family: "Microsoft YaHei"\n}\n.el-table th{background: #f2f7fb;\n}\n.productInfo{font-size: 14px;margin-bottom: 10px;\n}\n.productInfo .el-icon-info{font-size: 18px;color: #269ddd;margin-right: 10px;\n}\n.productInfo h5{font-family: "Microsoft YaHei"\n}\n.box-card{border:none;\n}\n.el-table .cell{font-family: "Microsoft YaHei"!important;\n}\n\n',""])},2141:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"layout-content",staticStyle:{height:"100%","background-color":"white"}},[o("div",{staticStyle:{height:"60px","font-size":"16px"}},[o("center",[o("h4",[e._v(e._s(e.approvedItemRecord.itemsBy.bsName))])])],1),e._v(" "),o("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[e.approvedItemRecord.bsPrId?o("div",[o("Col",{staticClass:"productInfo",attrs:{md:6}},[o("i",{staticClass:"el-icon-info"}),o("b",[e._v(e._s(e.$t("product.name"))+":")]),e._v(" "+e._s(e.productInfo.bsPrName))]),e._v(" "),o("Col",{staticClass:"productInfo",attrs:{md:6}},[o("span",[o("b",[e._v(e._s(e.$t("product.code"))+":")]),e._v(" "+e._s(e.productInfo.bsPrCode))])]),e._v(" "),o("Col",{attrs:{md:8}},[e.perms.edit?e._e():o("div",{staticClass:"frtxt",staticStyle:{"margin-top":"-10px"}},[o("Tag",{attrs:{type:"dot",color:"blue"}},[e._v(e._s(e.$t("approved.statusLabel"))+" : "+e._s(e.$t("approved.status["+e.approvedItemRecord.bsStatus+"]")))])],1)])],1):e._e(),e._v(" "),e.approvedItemRecord.bsSuppId?o("div",[o("Col",{staticClass:"productInfo",attrs:{md:8}},[o("h5",{staticStyle:{"font-size":"14px"}},[e._v(e._s(e.$t("product.SuppChieseName"))+": "+e._s(e.supplierInfo.bsSuppChieseName)+" "+e._s(e.supplierInfo.bsSuppEnglishName))])]),e._v(" "),o("Col",{staticClass:"productInfo",attrs:{md:8}},[o("h5",{staticStyle:{"font-size":"14px"}},[e._v(e._s(e.$t("product.SuppCode"))+": "+e._s(e.supplierInfo.bsSuppCode))])])],1):e._e(),e._v(" "),o("div",[o("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:e.terms}},[o("el-table-column",{attrs:{prop:"BS_NO",label:e.$t("New-audit.Article-number"),align:"center",width:"80"}}),e._v(" "),o("el-table-column",{attrs:{prop:"BS_CONTENT",align:"center",width:"320",label:e.$t("New-audit.Terms-conditions")}}),e._v(" "),o("el-table-column",{attrs:{label:e.$t("New-audit.Auditscore"),width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-select",{attrs:{placeholder:e.$t("choose"),disabled:!e.perms.edit},model:{value:t.row.BS_SCORE,callback:function(o){e.$set(t.row,"BS_SCORE",o)},expression:"scope.row.BS_SCORE"}},e._l(e.scoreOptions,function(e){return o("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})}))]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.$t("New-audit.AuditInstructions"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{type:"textarea",autosize:{minRows:1.3},readonly:!e.perms.edit},model:{value:t.row.BS_DESC,callback:function(o){e.$set(t.row,"BS_DESC",o)},expression:"scope.row.BS_DESC"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"BS_STANDARD",label:e.$t("New-audit.Grading"),align:"center"}})],1)],1)]),e._v(" "),o("el-card",{staticStyle:{"margin-top":"30px"},attrs:{shadow:"hover"}},[o("div",{staticClass:"uploadtxt",staticStyle:{margin:"30px"}},[o("h6",{staticClass:"uploadtext"},[e._v(e._s(e.$t("upcoming.UploadAttachment")))]),e._v(" "),o("div",{staticClass:"fileList",staticStyle:{padding:"0 15px"}},[o("upload",{attrs:{fileList:e.approvedItemRecord.fileSet,canUpload:e.perms.edit}})],1)])]),e._v(" "),o("approvedResultRecord",{attrs:{approvedData:e.approvedItemRecord}}),e._v(" "),e.perms.edit?o("div",{staticStyle:{"margin-top":"20px","margin-bottom":"50px"}},[o("ApprovedAction",{attrs:{type:"audits",data:e.terms,approvedItemRecord:e.approvedItemRecord},on:{updateTermsRecord:e.updateTermsRecord}})],1):e._e()],1)},s=[];a._withStripped=!0;var r={render:a,staticRenderFns:s};t.default=r},510:function(e,t,o){"use strict";function a(e){d||o(2139)}Object.defineProperty(t,"__esModule",{value:!0});var s=o(1797),r=o.n(s);for(var l in s)"default"!==l&&function(e){o.d(t,e,function(){return s[e]})}(l);var i=o(2141),n=o.n(i),d=!1,c=o(1),p=a,u=c(r.a,n.a,!1,p,null,null);u.options.__file="src/views/qms/view/approved/ApprovedItemRecordDetails.vue",t.default=u.exports}});