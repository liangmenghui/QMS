webpackJsonp([45],{1213:function(t,e,o){"use strict";function a(t){d||o(2119)}Object.defineProperty(e,"__esModule",{value:!0});var s=o(1931),r=o.n(s);for(var i in s)"default"!==i&&function(t){o.d(e,t,function(){return s[t]})}(i);var l=o(2121),n=o.n(l),d=!1,p=o(1),u=a,c=p(r.a,n.a,!1,u,null,null);c.options.__file="src/views/qms/view/settings/ApprovedFlowSettings.vue",e.default=c.exports},1931:function(t,e,o){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(22),r=a(s),i=o(11),l=a(i);e.default={data:function(){var t=this;return{menuTree:[],showMenuTree:!1,flowdata:{},dialog:{index:0,modal_dialog:!1,formItem:{selectedAudits:[],selectedUsers:[]},ruleForm:{bsName:[{required:!0,message:"请填写项目名称",trigger:"blur"}],bsType:[{required:!0,message:"请填写审核类型",trigger:"blur"}],bsContentType:[{required:!0,message:"请选择审核方式",trigger:"blur"}],bsRouter:[{required:!0,message:"请设置页面路由",trigger:"blur"}],userStr:[{required:!0,message:"请选择负责人",trigger:"blur"}]}},users:[],audits:[],originAudits:[],datagrid:{queryParams:{page:1,rows:25,pkParent:-1},pagination:[25,50,100],data:{rows:[],total:0},columns:[{title:this.$t("ApprovedFlow.ProjectName"),key:"bsName"},{title:this.$t("ApprovedFlow.PageRouting"),key:"bsRouterName"},{title:this.$t("ApprovedFlow.AuditMethod"),key:"bsContentType",render:function(e,o){return e("span",t.$t("approved.contentType["+o.row.bsContentType+"]"))}},{title:this.$t("ApprovedFlow.Principal"),key:"selectedUsers",render:function(t,e){return t("span",e.row.selectedUsers.map(function(t){return t.bsName}).toString())}},{title:this.$t("New-audit.Operating"),key:"action",render:function(e,o){var a=[];return a.push(e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){t.showEditDialog(o)}}},t.$t("Button.Edit"))),a.push(e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.delete(o)}}},t.$t("Button.Delete"))),e("div",a)}}]}}},created:function(){this.flowdata=this.$store.getters.getFlowdata,this.getAuditData(),this.getData()},methods:{renderContent:function(t,e){var o=this,a=e.root,s=e.node,r=e.data;return t("span",{style:{display:"inline-block",width:"100%"}},[t("span",[t("span",r.title)]),t("span",{style:{display:"inline-block",float:"right",marginRight:"32px"}},[t("Button",{props:(0,l.default)({},this.buttonProps,{icon:r.url==this.dialog.formItem.bsRouter?"ios-checkmark-outline":"ios-circle-outline",disabled:void 0!=s.children&&s.children.length>0}),style:{marginRight:"1px"},on:{click:function(){o.selectRouter(a,s,r)}}})])])},selectRouter:function(t,e,o){void 0==o.children&&(this.dialog.formItem.bsRouter=o.url,this.dialog.formItem.bsRouterName=o.title,this.showMenuTree=!1)},toSelectRouter:function(){var t={title:"供应商审核",url:"approved",children:[{title:"条款审核",url:"approved/itemsRecordDetails"},{title:"文件审核",url:"approved/otherReports"},{title:"审核报告",url:"approved/report"}]},e={title:"产品审核",url:"approved",children:[{title:"条款审核",url:"approved/itemsRecordDetails"},{title:"文件审核",url:"approved/otherReports"},{title:"审核报告",url:"approved/report"}]},o={title:"成品检验",url:"approved",children:[{title:"出货检验报告",url:"approved/inspectReport"},{title:"出货检验报告核查",url:"approved/inspectReportCheck"},{title:"文件审核",url:"approved/otherReports"}]};this.menuTree=[t,e,o],this.showMenuTree=!this.showMenuTree},getAuditData:function(){var t=this,e=this.flowdata.bsType>20?2:1;this.api.Audit.getlist({bsType:e}).then(function(e){e.result?t.originAudits=e.data.rows.map(function(t){return t.tag="",t}):t.$Message.error(e.msg)})},getData:function(){var t=this;this.api.ApprovedItem.getlist({bsFlowId:this.flowdata.id,bsType:this.flowdata.bsType}).then(function(e){if(e.result){for(var o=[],a=0;a<e.data.rows.length;a++){var s=e.data.rows[a];s.deletedAudits=[],s.selectedAudits=[],s.termsSet.sort(function(t,e){return t.termsBy.bsNo>e.termsBy.bsNo});for(var r=0;r<s.termsSet.length;r++){var i=s.termsSet[r],l=i.termsBy;l.tag="",l.bsIsDel&&(l.tag="(已删除)",s.deletedAudits.push(l)),i.bsIsDel||s.selectedAudits.push(l.id)}s.recorderSet.sort(function(t,e){return t.bsPriority>e.bsPriority}),s.selectedUsers=[];for(var r=0;r<s.recorderSet.length;r++){var n=s.recorderSet[r];n.bsIsDel||s.selectedUsers.push(n.recorderBy)}o.push(s)}e.data.rows=o,t.datagrid.data=e.data}else t.$Message.error(e.msg)}),this.api.user.getlist().then(function(e){t.users=e.data.rows})},delete:function(t){var e=this;if(t.index!=this.datagrid.data.rows.length-1)return void this.$Message.info("只能删除流程最后一步");this.$Modal.confirm({title:"提示信息",content:"<p>是否确定删除？</p>",onOk:function(){e.api.ApprovedItem.delete({id:t.row.id}).then(function(t){t.result?(e.getData(),e.$Modal.remove(),e.$Message.info("删除成功")):e.$Message.error(t.msg)})}})},showAddDialog:function(){this.dialog.modal_dialog=!0,this.dialog.formItem={selectedAudits:[],selectedUsers:[],bsType:this.flowdata.bsType},this.dialog.formItem.bsPriority=this.datagrid.data.rows.length+1,this.audits=this.originAudits},showEditDialog:function(t){this.dialog.modal_dialog=!0,this.dialog.formItem=(0,l.default)({},t.row),this.dialog.formItem.bsPriority=t.index+1,this.audits=(0,l.default)(this.originAudits,this.dialog.formItem.deletedAudits)},ok:function(){var t=this,e=this.dialog.formItem,o=e.selectedUsers.map(function(t){return t.id}).toString(),a={bsName:e.bsName,bsType:this.flowdata.bsType,bsRouter:e.bsRouter,bsRouterName:e.bsRouterName,bsContentType:e.bsContentType,bsFlowId:this.flowdata.id,bsPriority:e.bsPriority,termsStr:e.selectedAudits.toString(),userStr:o};void 0!=(0,r.default)(this.dialog.formItem.id)&&"number"==typeof this.dialog.formItem.id?(a.id=this.dialog.formItem.id,this.api.ApprovedItem.edit(a).then(function(e){e.result&&t.getData()})):this.api.ApprovedItem.add(a).then(function(e){e.result&&t.getData()})},cancel:function(){}}}},2119:function(t,e,o){var a=o(2120);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);o(21)("11480be4",a,!1)},2120:function(t,e,o){e=t.exports=o(20)(!1),e.push([t.i,'\n.box{padding:8px 20px; width: 100%;background: #fff;min-height: 600px;\n}\n.modeform .el-input{width: 300px;\n}\n.modeform .ivu-select-multiple .ivu-select-selection{width: 300px;\n}\n.modeform .settingBtn{width: 150px;\n}\n.modeform .ivu-select-multiple .ivu-tag{margin-top: 9px;\n}\n.flowtext{font-size: 14px; margin-left: 10px;line-height: 40px;\n}\n.createtitle {\n    padding-left: 3%;\n    height: 50px;\n    font-size: 16px;\n    font-family: "Microsoft YaHei";\n    background: #f2f7fb;\n    line-height: 50px;\n    margin-bottom: 20px;\n}\n.inputItem{width: 40%;display: inline-block;\n}\n\n',""])},2121:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"box"},[o("div",{staticClass:"createtitle"},[o("span",{staticClass:"el-icon-circle-plus-outline"}),t._v("\n       "+t._s(t.$t("approved.AuditProcessSetting"))+"\n    ")]),t._v(" "),o("el-form",{ref:"formItem",attrs:{model:t.flowdata,"label-width":"140px"}},[o("el-form-item",{staticClass:"inputItem",attrs:{label:t.$t("ApprovedFlow.Process-M"),prop:"bsName",readonly:""}},[o("el-input",{staticStyle:{width:"200px"},attrs:{readonly:"",placeholder:t.$t("Button.Keyword-search")},model:{value:t.flowdata.bsName,callback:function(e){t.$set(t.flowdata,"bsName",e)},expression:"flowdata.bsName"}})],1),t._v(" "),o("el-form-item",{staticClass:"inputItem",attrs:{label:t.$t("ApprovedFlow.FlowType"),prop:"bsType"}},[o("el-input",{staticStyle:{width:"200px"},attrs:{readonly:"",value:t.$t("approved.type["+t.flowdata.bsType+"]")}})],1),t._v(" "),o("el-form-item",{staticClass:"inputItem",attrs:{label:t.$t("ApprovedFlow.Principal"),prop:"bsApprovedUser"}},[o("el-input",{staticStyle:{width:"200px"},attrs:{readonly:""},model:{value:t.flowdata.approvedBy.bsName,callback:function(e){t.$set(t.flowdata.approvedBy,"bsName",e)},expression:"flowdata.approvedBy.bsName"}})],1),t._v(" "),o("el-form-item",{staticClass:"inputItem",attrs:{label:t.$t("approved.can_yield"),prop:"bsCanYield"}},[o("el-input",{staticStyle:{width:"200px"},attrs:{readonly:"",value:t.$t("approved.yield["+t.flowdata.bsCanYield+"]")}})],1),t._v(" "),o("el-form-item",{staticClass:"inputItem",attrs:{label:"通过审核状态",prop:"bsApprovedStatus"}},[t.flowdata.bsType<=20?o("el-input",{staticStyle:{width:"200px"},attrs:{readonly:"",value:t.$t("product.StatusDesc["+t.flowdata.bsApprovedStatus+"]")}}):t._e(),t._v(" "),t.flowdata.bsType>20?o("el-input",{staticStyle:{width:"200px"},attrs:{readonly:"",value:t.$t("supplier.StatusDesc["+t.flowdata.bsApprovedStatus+"]")}}):t._e()],1),t._v(" "),o("el-form-item",{staticClass:"inputItem",attrs:{label:"未过审核状态",prop:"bsRejectStatus"}},[t.flowdata.bsType<=20?o("el-input",{staticStyle:{width:"200px"},attrs:{readonly:"",value:t.$t("product.StatusDesc["+t.flowdata.bsRejectStatus+"]")}}):t._e(),t._v(" "),t.flowdata.bsType>20?o("el-input",{staticStyle:{width:"200px"},attrs:{readonly:"",value:t.$t("supplier.StatusDesc["+t.flowdata.bsRejectStatus+"]")}}):t._e()],1)],1),t._v(" "),o("el-Row",{staticStyle:{"margin-top":"5%"}},[o("el-col",{attrs:{span:2}},[o("div",{staticClass:"flowtext",attrs:{prop:"bsFlowId"},model:{value:t.flowdata.bsFlowId,callback:function(e){t.$set(t.flowdata,"bsFlowId",e)},expression:"flowdata.bsFlowId"}},[t._v(t._s(t.$t("ApprovedFlow.process")))])]),t._v(" "),o("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:function(e){t.showAddDialog()}}},[t._v(t._s(t.$t("Button.Newitem")))]),t._v(" "),o("el-col",{attrs:{span:24}},[o("Table",{staticStyle:{"margin-top":"15px"},attrs:{data:t.datagrid.data.rows,columns:t.datagrid.columns,stripe:""}})],1)],1),t._v(" "),o("Modal",{attrs:{title:t.$t("ApprovedFlow.Projectmanagement")},on:{"on-ok":t.ok,"on-cancel":t.cancel},model:{value:t.dialog.modal_dialog,callback:function(e){t.$set(t.dialog,"modal_dialog",e)},expression:"dialog.modal_dialog"}},[o("div",{staticClass:"modeform"},[o("el-form",{ref:t.dialog.formItem,attrs:{model:t.dialog.formItem,rules:t.dialog.ruleForm,"label-width":"120px"}},[o("el-form-item",{attrs:{label:t.$t("ApprovedFlow.ProjectName"),prop:"bsName"}},[o("el-input",{attrs:{placeholder:"请输入"},model:{value:t.dialog.formItem.bsName,callback:function(e){t.$set(t.dialog.formItem,"bsName",e)},expression:"dialog.formItem.bsName"}})],1),t._v(" "),o("el-form-item",{attrs:{label:t.$t("ApprovedFlow.PageRouting"),prop:"bsRouter"}},[void 0!=t.dialog.formItem.bsRouter?o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.toSelectRouter()}}},[t._v(t._s(t.dialog.formItem.bsRouterName))]):t._e(),t._v(" "),void 0==t.dialog.formItem.bsRouter?o("el-button",{attrs:{id:"settingBtn",type:"primary"},on:{click:function(e){t.toSelectRouter()}}},[t._v(t._s(t.$t("Button.NotSet")))]):t._e(),t._v(" "),t.showMenuTree?o("Tree",{attrs:{data:t.menuTree,render:t.renderContent}}):t._e()],1),t._v(" "),o("el-form-item",{attrs:{label:t.$t("ApprovedFlow.AuditMethod"),prop:"bsContentType"}},[o("el-select",{attrs:{placeholder:"请输入"},model:{value:t.dialog.formItem.bsContentType,callback:function(e){t.$set(t.dialog.formItem,"bsContentType",e)},expression:"dialog.formItem.bsContentType"}},[o("el-option",{attrs:{label:t.$t("approved.contentType[1]"),value:1}}),t._v(" "),o("el-option",{attrs:{label:t.$t("approved.contentType[2]"),value:2}})],1)],1),t._v(" "),1==t.dialog.formItem.bsContentType?o("el-form-item",{attrs:{label:t.$t("New-audit.Terms-conditions")}},[o("el-select",{staticStyle:{width:"260px"},attrs:{multiple:""},model:{value:t.dialog.formItem.selectedAudits,callback:function(e){t.$set(t.dialog.formItem,"selectedAudits",e)},expression:"dialog.formItem.selectedAudits"}},t._l(t.audits,function(t){return o("el-option",{key:t.id,attrs:{value:t.id,label:t.bsName+t.bsNo+t.tag}})}))],1):t._e(),t._v(" "),o("el-form-item",{attrs:{label:t.$t("ApprovedFlow.Principal")}},[o("el-select",{staticStyle:{width:"300px"},attrs:{multiple:"","value-key":"id",placeholder:"请选择"},model:{value:t.dialog.formItem.selectedUsers,callback:function(e){t.$set(t.dialog.formItem,"selectedUsers",e)},expression:"dialog.formItem.selectedUsers"}},t._l(t.users,function(t){return o("el-option",{key:t.id,attrs:{label:t.bsName,value:t}})}))],1)],1)],1)])],1)},s=[];a._withStripped=!0;var r={render:a,staticRenderFns:s};e.default=r}});